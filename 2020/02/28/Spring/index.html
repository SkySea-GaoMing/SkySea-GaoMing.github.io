<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Spring"><meta name="keywords" content="Java"><meta name="author" content="高明"><meta name="copyright" content="高明"><title>Spring | SkySea-GaoMing</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring简介"><span class="toc-number">2.</span> <span class="toc-text">spring简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring注解驱动"><span class="toc-number">3.</span> <span class="toc-text">Spring注解驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#容器"><span class="toc-number">3.1.</span> <span class="toc-text">容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展原理"><span class="toc-number">3.2.</span> <span class="toc-text">扩展原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">3.3.</span> <span class="toc-text">Web</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器-1"><span class="toc-number">4.</span> <span class="toc-text">容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC和DI"><span class="toc-number">4.1.</span> <span class="toc-text">IOC和DI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML配置"><span class="toc-number">4.1.1.</span> <span class="toc-text">XML配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注解配置"><span class="toc-number">4.1.2.</span> <span class="toc-text">注解配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自动扫描组件"><span class="toc-number">4.2.</span> <span class="toc-text">自动扫描组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML配置包扫描"><span class="toc-number">4.2.1.</span> <span class="toc-text">XML配置包扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注解配置扫描包"><span class="toc-number">4.2.2.</span> <span class="toc-text">注解配置扫描包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ComponentScan注解"><span class="toc-number">4.2.3.</span> <span class="toc-text">@ComponentScan注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#扫描时排除注解标注的类"><span class="toc-number">4.2.4.</span> <span class="toc-text">扫描时排除注解标注的类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#扫描时只包含注解标注的类"><span class="toc-number">4.2.5.</span> <span class="toc-text">扫描时只包含注解标注的类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重复注解"><span class="toc-number">4.2.6.</span> <span class="toc-text">重复注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义TypeFilter"><span class="toc-number">4.3.</span> <span class="toc-text">自定义TypeFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ANNOTATION"><span class="toc-number">4.3.1.</span> <span class="toc-text">ANNOTATION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASSIGNABLE-TYPE"><span class="toc-number">4.3.2.</span> <span class="toc-text">ASSIGNABLE_TYPE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASPECTJ"><span class="toc-number">4.3.3.</span> <span class="toc-text">ASPECTJ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REGEX"><span class="toc-number">4.3.4.</span> <span class="toc-text">REGEX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CUSTOM"><span class="toc-number">4.3.5.</span> <span class="toc-text">CUSTOM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件作用域"><span class="toc-number">4.4.</span> <span class="toc-text">组件作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scope注解概述"><span class="toc-number">4.4.1.</span> <span class="toc-text">@Scope注解概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单实例bean作用域"><span class="toc-number">4.4.2.</span> <span class="toc-text">单实例bean作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多实例bean作用域"><span class="toc-number">4.4.3.</span> <span class="toc-text">多实例bean作用域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单实例bean注意的事项"><span class="toc-number">4.4.4.</span> <span class="toc-text">单实例bean注意的事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义Scope"><span class="toc-number">4.5.</span> <span class="toc-text">自定义Scope</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一个自定义Scope实现"><span class="toc-number">4.5.1.</span> <span class="toc-text">一个自定义Scope实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#懒加载"><span class="toc-number">4.6.</span> <span class="toc-text">懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按照条件注册bean"><span class="toc-number">4.7.</span> <span class="toc-text">按照条件注册bean</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#不带条件注册bean"><span class="toc-number">4.7.1.</span> <span class="toc-text">不带条件注册bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#带条件注册bean"><span class="toc-number">4.7.2.</span> <span class="toc-text">带条件注册bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Conditional的扩展注解"><span class="toc-number">4.7.3.</span> <span class="toc-text">@Conditional的扩展注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Conditional与-Profile的对比"><span class="toc-number">4.7.4.</span> <span class="toc-text">@Conditional与@Profile的对比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环境搭建"><span class="toc-number">4.8.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写配置文件"><span class="toc-number">4.9.</span> <span class="toc-text">编写配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC控制反转（依赖注入DI）"><span class="toc-number">4.10.</span> <span class="toc-text">IOC控制反转（依赖注入DI）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring对象的创建时间"><span class="toc-number">4.11.</span> <span class="toc-text">Spring对象的创建时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#set注入"><span class="toc-number">4.11.1.</span> <span class="toc-text">set注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造器注入"><span class="toc-number">4.12.</span> <span class="toc-text">构造器注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#p命名空间注入"><span class="toc-number">4.13.</span> <span class="toc-text">p命名空间注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注入各种数据类型"><span class="toc-number">4.14.</span> <span class="toc-text">注入各种数据类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特殊值注入问题以及类型自动匹配"><span class="toc-number">5.</span> <span class="toc-text">特殊值注入问题以及类型自动匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自动装配（只适用于引用类型）"><span class="toc-number">5.1.</span> <span class="toc-text">自动装配（只适用于引用类型）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注解"><span class="toc-number">6.</span> <span class="toc-text">注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置扫描器"><span class="toc-number">6.1.</span> <span class="toc-text">配置扫描器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Required"><span class="toc-number">6.1.1.</span> <span class="toc-text">Required</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Resource"><span class="toc-number">6.1.2.</span> <span class="toc-text">Resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Qualifier"><span class="toc-number">6.1.3.</span> <span class="toc-text">Qualifier</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用注解声明事务"><span class="toc-number">6.1.4.</span> <span class="toc-text">使用注解声明事务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP面向切面编程"><span class="toc-number">7.</span> <span class="toc-text">AOP面向切面编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#切入点与切面"><span class="toc-number">7.1.</span> <span class="toc-text">切入点与切面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通知"><span class="toc-number">7.2.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类变为通知"><span class="toc-number">7.3.</span> <span class="toc-text">类变为通知</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于注解形式的AOP"><span class="toc-number">8.</span> <span class="toc-text">基于注解形式的AOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring开发web项目"><span class="toc-number">9.</span> <span class="toc-text">spring开发web项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web程序初始化IOC容器"><span class="toc-number">9.1.</span> <span class="toc-text">web程序初始化IOC容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#监听器"><span class="toc-number">9.2.</span> <span class="toc-text">监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拆分配置文件"><span class="toc-number">9.3.</span> <span class="toc-text">拆分配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java项目"><span class="toc-number">9.3.1.</span> <span class="toc-text">Java项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web项目"><span class="toc-number">9.3.2.</span> <span class="toc-text">web项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用注解总结"><span class="toc-number">10.</span> <span class="toc-text">常用注解总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBootApplication"><span class="toc-number">10.1.</span> <span class="toc-text">@SpringBootApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Autowired"><span class="toc-number">10.2.</span> <span class="toc-text">@Autowired</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Component-Repository-Service-Controller"><span class="toc-number">10.3.</span> <span class="toc-text">Component,@Repository,@Service, @Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RestController"><span class="toc-number">10.4.</span> <span class="toc-text">@RestController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scope"><span class="toc-number">10.5.</span> <span class="toc-text">@Scope</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration"><span class="toc-number">10.6.</span> <span class="toc-text">@Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-请求"><span class="toc-number">10.7.</span> <span class="toc-text">Get 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST-请求"><span class="toc-number">10.8.</span> <span class="toc-text">POST 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PUT-请求"><span class="toc-number">10.9.</span> <span class="toc-text">PUT 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DELETE-请求"><span class="toc-number">10.10.</span> <span class="toc-text">DELETE 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PATCH-请求"><span class="toc-number">10.11.</span> <span class="toc-text">PATCH 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PathVariable-和-RequestParam"><span class="toc-number">10.12.</span> <span class="toc-text">@PathVariable 和 @RequestParam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestBody"><span class="toc-number">10.13.</span> <span class="toc-text">@RequestBody</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读取配置信息"><span class="toc-number">10.14.</span> <span class="toc-text">读取配置信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Value"><span class="toc-number">10.15.</span> <span class="toc-text">@Value</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurationProperties"><span class="toc-number">10.16.</span> <span class="toc-text">@ConfigurationProperties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PropertySource"><span class="toc-number">10.17.</span> <span class="toc-text">PropertySource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数校验"><span class="toc-number">10.18.</span> <span class="toc-text">参数校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些常用的字段验证的注解"><span class="toc-number">10.19.</span> <span class="toc-text">一些常用的字段验证的注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证请求参数"><span class="toc-number">10.20.</span> <span class="toc-text">验证请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局处理Controller-层异常"><span class="toc-number">10.21.</span> <span class="toc-text">全局处理Controller 层异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transactional"><span class="toc-number">10.22.</span> <span class="toc-text">@Transactional</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试相关"><span class="toc-number">10.23.</span> <span class="toc-text">测试相关</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2762516417,1589137703&amp;fm=26&amp;gp=0.jpg"></div><div class="author-info__name text-center">高明</div><div class="author-info__description text-center">JAVA工程师</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">81</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">17</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SkySea-GaoMing</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Spring</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2020/02/28/Spring/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2020/02/28/Spring/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>B站颜群老师Spring教程，B站雷丰阳老师Spring教程，《Spring实战》<br><a href="https://zhuanlan.zhihu.com/p/137507309" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/137507309</a><br><a href="https://liayun.blog.csdn.net/article/details/115053350" target="_blank" rel="noopener">https://liayun.blog.csdn.net/article/details/115053350</a></p>
<h2 id="spring简介"><a href="#spring简介" class="headerlink" title="spring简介"></a>spring简介</h2><p>Spring起源于2003年，有两大核心（IOC,AOP），如今已经发展到springdata<br>springboot springframework springsocial，适合做各种项目</p>
<h2 id="Spring注解驱动"><a href="#Spring注解驱动" class="headerlink" title="Spring注解驱动"></a>Spring注解驱动</h2><p>可以分为三个部分学习：容器、扩展原理以及Web</p>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p>第一部分 <img src="/2020/02/28/Spring/1.jpg" alt></p>
<ol>
<li>AnnotationConfigApplicationContext</li>
<li>组件添加</li>
<li>组件赋值</li>
<li>组件注入</li>
<li>AOP</li>
<li>声明式事务</li>
</ol>
<h3 id="扩展原理"><a href="#扩展原理" class="headerlink" title="扩展原理"></a>扩展原理</h3><p>第二部分 <img src="/2020/02/28/Spring/2.jpg" alt></p>
<ol>
<li>BeanFactoryPostProcessor</li>
<li>BeanDefinitionRegistryPostProcessor</li>
<li>ApplicationListener</li>
<li>Spring容器创建过程</li>
</ol>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p>第三部分，其实就是SpringMVC <img src="/2020/02/28/Spring/3.jpg" alt></p>
<ol>
<li>servlet3.0</li>
<li>异步请求</li>
</ol>
<h2 id="容器-1"><a href="#容器-1" class="headerlink" title="容器"></a>容器</h2><p>一开始学习Spring是通过XML配置文件来定义我们的bean的，这种编写XML<br>配置文件的方式不仅繁琐，而且还很容易出错。使用Spring注解驱动来开发<br>就不需要编写XML配置</p>
<h3 id="IOC和DI"><a href="#IOC和DI" class="headerlink" title="IOC和DI"></a>IOC和DI</h3><p>在Spring容器的底层，最重要的功能就是IOC和DI，也就是控制反转和依赖<br>注入 <img src="/2020/02/28/Spring/4.jpg" alt><br>DI和IOC它俩之间的关系是DI不能单独存在，DI需要在IOC的基础上来完成。<br>在Spring内部，所有的组件都会放到IOC容器中，组件之间的关系通过IOC<br>容器来自动装配，也就是我们所说的依赖注入</p>
<h4 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h4><p>在介绍使用注解完成容器中组件的注册、管理及依赖、注入等功能之前，我们<br>先来看看使用XML配置文件是如何注入bean的。<br>首先创建一个com.atguigu.bean.Person类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	...</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Person [name="</span> + name + <span class="string">", age="</span> + age + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在工程的src/main/resources目录下创建Spring的配置文件，例如beans.xml<br>，通过该配置文件将Person类注入到Spring的IOC容器中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                        /spring-beans-4.2.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 注册组件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.bean.Person"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"liayun"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>新建一个MainTest类测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> </span><br><span class="line">		ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line">		Person person = (Person) applicationContext.getBean(<span class="string">"person"</span>);</span><br><span class="line">		System.out.println(person);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h4><p>在项目的com.meimeixia.config包下创建一个MainConfig类，并在该类上<br>添加@Configuration注解来标注该类是一个Spring的配置类，也就是告诉<br>Spring它是一个配置类，最后通过@Bean注解将Person类注入到Spring的<br>IOC容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以前配置文件的方式被替换成了配置类，即配置类==配置文件</span></span><br><span class="line"><span class="comment">// 这个配置类也是一个组件 </span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 告诉Spring这是一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig</span> </span>&#123;</span><br><span class="line">	<span class="comment">//@Bean注解是给IOC容器中注册一个bean，类型就是返回值的类型，id默认是用方法名作为id</span></span><br><span class="line">	<span class="comment">//@Bean("person") 也可以指定id</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"liayun"</span>, <span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来通过注解式获取bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> </span><br><span class="line">		AnnotationConfigApplicationContext(MainConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		Person person = applicationContext.getBean(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		System.out.println(person);</span><br><span class="line">		<span class="comment">// Person这个类型的组件在IOC容器中的名字</span></span><br><span class="line">		String[] namesForType = applicationContext.getBeanNamesForType(</span><br><span class="line">			Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">for</span> (String name : namesForType) &#123;</span><br><span class="line">    		System.out.println(name);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自动扫描组件"><a href="#自动扫描组件" class="headerlink" title="自动扫描组件"></a>自动扫描组件</h3><p>在实际项目中，我们更多的是使用Spring的包扫描功能对项目中的包进行扫<br>描，凡是在指定的包或其子包中的类上标注了@Repository 、 @Service、<br>@Controller 、@Component 注解的类都会被扫描到，并将这个类注入到<br>Spring容器中</p>
<h4 id="XML配置包扫描"><a href="#XML配置包扫描" class="headerlink" title="XML配置包扫描"></a>XML配置包扫描</h4><p>我们可以在Spring的XML配置文件中配置包的扫描，在配置包扫描时，需要<br>在Spring的XML配置文件中的beans节点中引入context标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 包扫描：只要是标注了我们熟悉的@Controller、@Service、@Repository</span></span><br><span class="line"><span class="comment">、@Component这四个注解中的任何一个的组件，它就会被自动扫描，并加进容器中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样配置以后，只要在com.atguigu包下或者其的子包下标注了@Repository<br>、@Service、@Controller、@Component注解的类都会被扫描到，并自动注入<br>到Spring容器中</p>
<h4 id="注解配置扫描包"><a href="#注解配置扫描包" class="headerlink" title="注解配置扫描包"></a>注解配置扫描包</h4><p>只须在我们的MainConfig类上添加@ComponentScan注解，并将扫描的包指定<br>为com.atguigu即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认会扫描该类所在的包下所有的类</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>) <span class="comment">// value指定要扫描的包</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 告诉Spring这是一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig</span> </span>&#123;</span><br><span class="line">	<span class="comment">//@Bean注解是给IOC容器中注册一个bean，类型就是返回值的类型，id默认是用方法名作为id</span></span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"liayun"</span>, <span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在src/test/java目录下新建一个单元测试类来进行测试，使用junit需要添<br>加相应依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写测试类获取IOC容量中的所有bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOCTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"resource"</span>)</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPathXmlApplicationContext applicationContext = </span><br><span class="line">		<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line">		<span class="comment">// 我们现在就来看一下IOC容器中有哪些bean，即容器中所有bean定义的名字</span></span><br><span class="line">		String[] definitionNames = applicationContext.getBeanDefinitionNames();</span><br><span class="line">		<span class="keyword">for</span> (String name : definitionNames) &#123;</span><br><span class="line">			System.out.println(name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ComponentScan注解"><a href="#ComponentScan注解" class="headerlink" title="@ComponentScan注解"></a>@ComponentScan注解</h4><p>可以设置指定要扫描或排除的组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScan &#123;</span><br><span class="line">	<span class="comment">//指定Spring扫描的时候按照什么规则只需要包含哪些组件</span></span><br><span class="line">	ComponentScan.Filter[] includeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	<span class="comment">//指定Spring扫描的时候按照什么规则排除哪些组件</span></span><br><span class="line">    ComponentScan.Filter[] excludeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个方法的返回值都是Filter[]数组，在ComponentScan注解类的内部<br>存在Filter注解类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Filter &#123;</span><br><span class="line">        <span class="function">FilterType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> FilterType.ANNOTATION</span>;</span><br><span class="line">        <span class="meta">@AliasFor</span>(<span class="string">"classes"</span>)</span><br><span class="line">        Class&lt;?&gt;[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">        <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">        Class&lt;?&gt;[] classes() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">        String[] pattern() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="扫描时排除注解标注的类"><a href="#扫描时排除注解标注的类" class="headerlink" title="扫描时排除注解标注的类"></a>扫描时排除注解标注的类</h4><p>现在有这样一个需求，除了@Controller和@Service标注的组件之外，IOC<br>容器中剩下的组件我都要，即相当于是我要排除@Controller和@Service<br>这俩注解标注的组件。要想达到这样一个目的，我们可以在MainConfig类<br>上通过@ComponentScan注解的excludeFilters()方法实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, excludeFilters=&#123;</span><br><span class="line">    <span class="comment">/*type：指定你要排除的规则，是按照注解进行排除，还是按照给定的类型进行排除，</span></span><br><span class="line"><span class="comment">    还是按照正则表达式进行排除等等*/</span></span><br><span class="line">    <span class="comment">/*classes：除了@Controller和@Service标注的组件之外，IOC容器中剩下的组件</span></span><br><span class="line"><span class="comment">    我都要，即相当于是我要排除@Controller和@Service这俩注解标注的组件*/</span></span><br><span class="line">	<span class="meta">@Filter</span>(type=FilterType.ANNOTATION, classes=&#123;Controller<span class="class">.<span class="keyword">class</span>, </span></span><br><span class="line"><span class="class">		<span class="title">Service</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;)</span></span><br></pre></td></tr></table></figure>
<h4 id="扫描时只包含注解标注的类"><a href="#扫描时只包含注解标注的类" class="headerlink" title="扫描时只包含注解标注的类"></a>扫描时只包含注解标注的类</h4><p>可以使用ComponentScan注解类中的includeFilters()方法来指定Spring<br>在进行包扫描时，只包含哪些注解标注的类。这里需要注意的是，当我们使<br>用includeFilters() 方法来指定只包含哪些注解标注的类时，需要禁用<br>掉默认的过滤规则。<br>现在有这样一个需求，我们需要Spring在扫描时，只包含@Controller注解<br>标注的类。要想达到这样一个目的，我们该怎么做呢？可以在MainConfig类<br>上添加@ComponentScan注解，设置只包含@Controller注解标注的类，并<br>禁用掉默认的过滤规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, includeFilters=&#123;</span><br><span class="line">		</span><br><span class="line">		 <span class="comment">/*type：指定你要排除的规则，是按照注解进行排除，还是按照给定的类</span></span><br><span class="line"><span class="comment">		    型进行排除，还是按照正则表达式进行排除，等等*/</span></span><br><span class="line">		 <span class="comment">//classes：我们需要Spring在扫描时，只包含@Controller注解标注的类</span></span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ANNOTATION, classes=&#123;Controller<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure>
<p>注意在使用includeFilters()方法来指定只包含哪些注解标注的类时，结果<br>信息中会一同输出Spring内部的组件名称，也就是没有用这些注解的Bean</p>
<h4 id="重复注解"><a href="#重复注解" class="headerlink" title="重复注解"></a>重复注解</h4><p>@ComponentScan注解上有一个@Repeatable(ComponentScans.class)注解<br>，在ComponentScans注解类的内部只声明了一个返回ComponentScan[]数组<br>的value()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScans &#123;</span><br><span class="line">    ComponentScan[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以在一个类上重复使用这个注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ANNOTATION, classes=&#123;Controller<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ANNOTATION, classes=&#123;Service<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义TypeFilter"><a href="#自定义TypeFilter" class="headerlink" title="自定义TypeFilter"></a>自定义TypeFilter</h3><p>在使用@ComponentScan注解实现包扫描时，我们可以使用@Filter指定过<br>滤规则，在@Filter中，通过type来指定过滤的类型。而@Filter 注解中<br>的type属性是一个FilterType枚举</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> FilterType &#123;</span><br><span class="line">    ANNOTATION,</span><br><span class="line">    ASSIGNABLE_TYPE,</span><br><span class="line">    ASPECTJ,</span><br><span class="line">    REGEX,</span><br><span class="line">    CUSTOM;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">FilterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ANNOTATION"><a href="#ANNOTATION" class="headerlink" title="ANNOTATION"></a>ANNOTATION</h4><p>按照注解进行包含或者排除，例如使用@ComponentScan注解进行包扫描<br>时，如果要想按照注解只包含标注了@Controller注解的组件，那么就<br>需要像下面这样写了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ANNOTATION, classes=&#123;Controller<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>
<h4 id="ASSIGNABLE-TYPE"><a href="#ASSIGNABLE-TYPE" class="headerlink" title="ASSIGNABLE_TYPE"></a>ASSIGNABLE_TYPE</h4><p>按照给定的类型进行包含或者排除，例如使用@ComponentScan注解进行<br>包扫描时，如果要想按照给定的类型只包含BookService类（接口）或<br>其子类（实现类或子接口）的组件，那么就需要像下面这样写了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigu"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="comment">/* 只要是BookService这种类型的组件都会被加载到容器中，不管是</span></span><br><span class="line"><span class="comment">		它的子类还是什么它的实现类。只要是BookService这种类型的*/</span></span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ASSIGNABLE_TYPE, classes=&#123;BookService<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>
<h4 id="ASPECTJ"><a href="#ASPECTJ" class="headerlink" title="ASPECTJ"></a>ASPECTJ</h4><p>按照ASPECTJ表达式进行包含或者排除，例如使用@ComponentScan注解<br>进行包扫描时，按照正则表达式进行过滤，就得像下面这样子写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigua"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.ASPECTJ, classes=&#123;AspectJTypeFilter<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>
<h4 id="REGEX"><a href="#REGEX" class="headerlink" title="REGEX"></a>REGEX</h4><p>按照正则表达式进行包含或者排除，例如使用@ComponentScan注解进行<br>包扫描时，按照正则表达式进行过滤，就得像下面这样子写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigua"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.REGEX, classes=&#123;RegexPatternTypeFilter<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>
<h4 id="CUSTOM"><a href="#CUSTOM" class="headerlink" title="CUSTOM"></a>CUSTOM</h4><p>按照自定义规则进行包含或者排除，如果实现自定义规则进行过滤时，自<br>定义规则的类必须是 TypeFilter 接口的实现类，需要实现该接口中的<br>match()方法，match()方法的返回值为boolean类型。当返回true时，<br>表示符合规则，会包含在Spring容器中，当返回false时，表示不符合<br>规则，那就是一个都不匹配，自然就都不会被包含在Spring容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigua.config;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title">TypeFilter</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 参数：</span></span><br><span class="line"><span class="comment">	 * metadataReader：读取到的当前正在扫描的类的信息</span></span><br><span class="line"><span class="comment">	 * metadataReaderFactory：可以获取到其他任何类的信息的（工厂）</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(MetadataReader metadataReader, </span></span></span><br><span class="line"><span class="function"><span class="params">		MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 获取当前类注解的信息</span></span><br><span class="line">		AnnotationMetadata annotationMetadata = </span><br><span class="line">			metadataReader.getAnnotationMetadata();</span><br><span class="line">		<span class="comment">//获取当前正在扫描的类的类信息，比如说它的类型是什么啊，它实现了什么接口之类的</span></span><br><span class="line">		ClassMetadata classMetadata = metadataReader.getClassMetadata();</span><br><span class="line">		<span class="comment">// 获取当前类的资源信息，比如说类的路径等信息</span></span><br><span class="line">		Resource resource = metadataReader.getResource();</span><br><span class="line">		<span class="comment">// 获取当前正在扫描的类的类名</span></span><br><span class="line">		String className = classMetadata.getClassName();</span><br><span class="line">		System.out.println(<span class="string">"---&gt;"</span> + className);</span><br><span class="line">		<span class="comment">// 现在来指定一个规则</span></span><br><span class="line">		<span class="keyword">if</span> (className.contains(<span class="string">"er"</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// 匹配成功，就会被包含在容器中</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">// 这儿我们先让其返回false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义过滤规则时扫描的是com.atguigua包，该包下的每一个类都会进<br>到这个自定义规则里面进行匹配，包括MyTypeFilter类，配置过程如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.atguigua"</span>, includeFilters=&#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type=FilterType.CUSTOM, classes=&#123;MyTypeFilter<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">&#125;, <span class="title">useDefaultFilters</span></span>=<span class="keyword">false</span>) <span class="comment">// value指定要扫描的包</span></span><br></pre></td></tr></table></figure>

<h3 id="组件作用域"><a href="#组件作用域" class="headerlink" title="组件作用域"></a>组件作用域</h3><p>Spring容器中的组件默认是单例的，在Spring启动时就会实例化并初始<br>化这些对象，并将其放到Spring容器中，之后，每次获取对象时，直接<br>从Spring容器中获取，而不再创建对象。如果每次从Spring容器中获取<br>对象时，都要创建一个新的实例对象，那么该如何处理呢？此时就需要<br>使用@Scope注解来设置组件的作用域了，内容如下</p>
<ul>
<li>@Scope注解概述</li>
<li>单实例bean作用域</li>
<li>多实例bean作用域</li>
<li>单实例bean作用域如何创建对象？</li>
<li>多实例bean作用域如何创建对象？</li>
<li>单实例bean注意的事项</li>
<li>多实例bean注意的事项</li>
<li>自定义Scope的实现</li>
</ul>
<h4 id="Scope注解概述"><a href="#Scope注解概述" class="headerlink" title="@Scope注解概述"></a>@Scope注解概述</h4><p>在@Scope注解中的取值如下所示 <img src="/2020/02/28/Spring/5.jpg" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope &#123;</span><br><span class="line">	<span class="comment">/*  在@Scope注解中可以设置如下值：</span></span><br><span class="line"><span class="comment">		ConfigurableBeanFactory#SCOPE_PROTOTYPE</span></span><br><span class="line"><span class="comment">		ConfigurableBeanFactory#SCOPE_SINGLETON</span></span><br><span class="line"><span class="comment">		org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST</span></span><br><span class="line"><span class="comment">		org.springframework.web.context.WebApplicationContext#SCOPE_SESSION</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"scopeName"</span>)</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">    <span class="function">String <span class="title">scopeName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="function">ScopedProxyMode <span class="title">proxyMode</span><span class="params">()</span> <span class="keyword">default</span> ScopedProxyMode.DEFAULT</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>request和session作用域是需要Web环境来支持的，这两个值基本上使<br>用不到。当我们使用Web容器来运行Spring应用时，如果需要将组件的<br>实例对象的作用域设置为request和session，那么我们通常会使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">"key"</span>, object);</span><br><span class="line">session.setAttribute(<span class="string">"key"</span>, object);</span><br></pre></td></tr></table></figure>

<h4 id="单实例bean作用域"><a href="#单实例bean作用域" class="headerlink" title="单实例bean作用域"></a>单实例bean作用域</h4><p>首先在com.atguigua.config包下创建一个配置类，例如MainConfig2<br>，然后在该配置类中实例化一个Person对象，并将其放置在Spring容<br>器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个测试方法，Spring容器在启动时就会将实例对象加载到Spring<br>容器中，之后每次从Spring容器中获取实例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"resource"</span>)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(MainConfig2<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*获取到的这个Person对象默认是单实例的，因为在IOC容器中给我们加的</span></span><br><span class="line"><span class="comment">    这些组件默认都是单实例的，所以说在这儿我们无论多少次获取，获取到的</span></span><br><span class="line"><span class="comment">    都是我们之前new的那个实例对象*/</span></span><br><span class="line">    Person person = (Person) applicationContext.getBean(<span class="string">"person"</span>);</span><br><span class="line">    Person person2 = (Person) applicationContext.getBean(<span class="string">"person"</span>);</span><br><span class="line">    System.out.println(person == person2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="多实例bean作用域"><a href="#多实例bean作用域" class="headerlink" title="多实例bean作用域"></a>多实例bean作用域</h4><p>修改Spring容器中组件的作用域，我们需要借助于@Scope注解。此时我<br>们将MainConfig2配置类中Person对象的作用域修改成prototype</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="comment">//通过@Scope注解来指定该bean的作用范围，也可以说成是调整作用域</span></span><br><span class="line">	<span class="meta">@Scope</span>(<span class="string">"prototype"</span>) </span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单实例bean注意的事项"><a href="#单实例bean注意的事项" class="headerlink" title="单实例bean注意的事项"></a>单实例bean注意的事项</h4><p>单实例bean是整个应用所共享的，所以需要考虑到线程安全问题，SpringMVC<br>中的Controller默认是单例的，有些开发者在Controller中创建了一些变量<br>，那么这些变量实际上就变成共享的了，Controller又可能会被很多线程同<br>时访问，这些线程并发去修改Controller中的共享变量，此时很有可能会出<br>现数据错乱的问题，所以使用的时候需要特别注意</p>
<h3 id="自定义Scope"><a href="#自定义Scope" class="headerlink" title="自定义Scope"></a>自定义Scope</h3><p>自定义Scope主要分为三个步骤</p>
<ol>
<li>实现Scope接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Scope</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回当前作用域中name对应的bean对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 需要检索的bean对象的名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> objectFactory 如果name对应的bean对象在当前作用域中没有找</span></span><br><span class="line"><span class="comment">	 	到，那么可以调用这个objectFactory来创建这个对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">Object <span class="title">get</span><span class="params">(String name, ObjectFactory&lt;?&gt; objectFactory)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将name对应的bean对象从当前作用域中移除</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">Object <span class="title">remove</span><span class="params">(String name)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于注册销毁回调，若想要销毁相应的对象，则由Spring容器注册相应</span></span><br><span class="line"><span class="comment">	 的销毁回调，而由自定义作用域选择是不是要销毁相应的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">registerDestructionCallback</span><span class="params">(String name, Runnable callback)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于解析相应的上下文数据，比如request作用域将返回request中的属性</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">Object <span class="title">resolveContextualObject</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 作用域的会话标识，比如session作用域的会话标识是sessionId</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getConversationId</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>将自定义Scope注册到容器中，此时需要调用ConfigurableBeanFactory<br>#registerScope这个方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">registerScope</span><span class="params">(String scopeName,Scope scope)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>第三步，使用自定义的作用域。也就是在定义bean的时候，指定bean的<br>scope属性为自定义的作用域名称</li>
</ol>
<h4 id="一个自定义Scope实现"><a href="#一个自定义Scope实现" class="headerlink" title="一个自定义Scope实现"></a>一个自定义Scope实现</h4><p>例如我们来实现一个线程级别的bean作用域，同一个线程中同名的bean是同<br>一个实例，不同的线程中的bean是不同的实例，要求bean在线程中是共享的<br>，所以我们可以通过ThreadLocal来实现，ThreadLocal可以实现线程中数<br>据的共享</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="comment">/*自定义本地线程级别的bean作用域，不同的线程中的bean是不同的实例</span></span><br><span class="line"><span class="comment"> ，同一个线程中同名的bean是同一个实例*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadScope</span> <span class="keyword">implements</span> <span class="title">Scope</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String THREAD_SCOPE = <span class="string">"thread"</span>;</span><br><span class="line">	<span class="keyword">private</span> ThreadLocal&lt;Map&lt;String, Object&gt;&gt; beanMap = <span class="keyword">new</span> ThreadLocal() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Object <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回当前作用域中name对应的bean对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 需要检索的bean对象的名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> objectFactory 如果name对应的bean对象在当前作用域中没有找到，</span></span><br><span class="line"><span class="comment">	 那么可以调用这个objectFactory来创建这个bean对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String name, ObjectFactory&lt;?&gt; objectFactory)</span> </span>&#123;</span><br><span class="line">		Object bean = beanMap.get().get(name);</span><br><span class="line">		<span class="keyword">if</span> (Objects.isNull(bean)) &#123;</span><br><span class="line">			bean = objectFactory.getObject();</span><br><span class="line">			beanMap.get().put(name, bean);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将name对应的bean对象从当前作用域中移除</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">remove</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.beanMap.get().remove(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于注册销毁回调，若想要销毁相应的对象，则由Spring容器注册相</span></span><br><span class="line"><span class="comment">	 应的销毁回调，而由自定义作用域选择是不是要销毁相应的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// bean作用域范围结束的时候调用的方法，用于bean的清理</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerDestructionCallback</span><span class="params">(String name, Runnable callback)</span> </span>&#123;</span><br><span class="line">		System.out.println(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用于解析相应的上下文数据，比如request作用域将返回request中的属性</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">resolveContextualObject</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 作用域的会话标识，比如session作用域的会话标识是sessionId</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getConversationId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Thread.currentThread().getName();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在ThreadScope类中，我们定义了一个THREAD_SCOPE常量，该常量是在定<br>义bean的时候给scope使用的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig3</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Scope</span>(<span class="string">"thread"</span>)</span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"给容器中添加咱们这个Person对象..."</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h3><p>Spring在启动时，默认会将单实例bean进行实例化，并加载到Spring容<br>器中去。也就是说，单实例bean默认是在Spring容器启动的时候创建对<br>象，并且还会将对象加载到Spring容器中。如果我们需要对某个bean进<br>行延迟加载，那么该如何处理呢？此时，就需要使用到@Lazy注解了。<br>懒加载就是Spring容器启动的时候，先不创建对象，在第一次使用（获取<br>）bean的时候再来创建对象，并进行一些初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Lazy</span></span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"给容器中添加咱们这个Person对象..."</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用@Lazy注解标注后，单实例bean对象只是在第一次从Spring容器中获<br>取时被创建，以后每次获取bean 对象时，直接返回创建好的对象，仅针<br>对单实例bean生效</p>
<h3 id="按照条件注册bean"><a href="#按照条件注册bean" class="headerlink" title="按照条件注册bean"></a>按照条件注册bean</h3><p>Spring支持按照条件向IOC容器中注册bean，满足条件的bean就会被注册到<br>IOC容器中，不满足条件的bean就不会被注册到IOC容器中。@Conditional<br>注解可以按照一定的条件进行判断，满足条件向容器中注册bean，不满足<br>条件就不向容器中注册bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Conditional &#123;</span><br><span class="line">    Class&lt;? extends Condition&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从@Conditional注解的源码来看，@Conditional注解不仅可以添加到类上<br>，也可以添加到方法上。在@Conditional注解中，还存在一个Condition<br>类型或者其子类型的Class对象数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext var1, AnnotatedTypeMetadata var2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用@Conditional注解时，需要写一个类来实现Spring提供的Condition<br>接口，它会匹配@Conditional所符合的方法 <img src="/2020/02/28/Spring/6.jpg" alt></p>
<h4 id="不带条件注册bean"><a href="#不带条件注册bean" class="headerlink" title="不带条件注册bean"></a>不带条件注册bean</h4><p>MainConfig2配置类中新增person01()方法和person02()方法，并为这两<br>个方法添加@Bean注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Lazy</span></span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"给容器中添加咱们这个Person对象..."</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"bill"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Bill Gates"</span>, <span class="number">62</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"linus"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"linus"</span>, <span class="number">48</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试是否被注册到IOC容器，三个bean都被注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test06</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext applicationContext = </span><br><span class="line">    <span class="keyword">new</span> AnnotationConfigApplicationContext(MainConfig2<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">//我们现在就来看一下IOC容器中Person这种类型的bean都有哪些</span></span><br><span class="line">    String[] namesForType = applicationContext.getBeanNamesForType(</span><br><span class="line">    	Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">for</span> (String name : namesForType) &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Person&gt; persons = applicationContext.getBeansOfType(</span><br><span class="line">    	Person<span class="class">.<span class="keyword">class</span>)</span>; <span class="comment">// 找到这个Person类型的所有bean</span></span><br><span class="line">    System.out.println(persons);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="带条件注册bean"><a href="#带条件注册bean" class="headerlink" title="带条件注册bean"></a>带条件注册bean</h4><p>我们现在提出一个新的需求，比如如果当前操作系统是Windows操作系统<br>，那么就向Spring 容器中注册名称为bill 的Person 对象，如果当前<br>操作系统是Linux 操作系统，那么就向Spring容器中注册名称为linus<br>的Person对象。要想实现这个需求就得要使用@Conditional注解了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test06</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext applicationContext = </span><br><span class="line">    	<span class="keyword">new</span> AnnotationConfigApplicationContext(MainConfig2<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 我们现在就来看一下IOC容器中Person这种类型的bean都有哪些</span></span><br><span class="line">    String[] namesForType = applicationContext.getBeanNamesForType(</span><br><span class="line">    	Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 拿到IOC运行环境</span></span><br><span class="line">    ConfigurableEnvironment environment = applicationContext.getEnvironment();</span><br><span class="line">    <span class="comment">// 动态获取坏境变量的值，例如操作系统的名字</span></span><br><span class="line">    String property = environment.getProperty(<span class="string">"os.name"</span>); </span><br><span class="line">    <span class="comment">// 获取操作系统的名字，例如Windows 10</span></span><br><span class="line">    System.out.println(property);</span><br><span class="line">    <span class="keyword">for</span> (String name : namesForType) &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Person&gt; persons = applicationContext.getBeansOfType(</span><br><span class="line">    	Person<span class="class">.<span class="keyword">class</span>)</span>; <span class="comment">// 找到这个Person类型的所有bean</span></span><br><span class="line">    System.out.println(persons);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要想使用@Conditional注解，我们需要实现Condition接口来为@Conditional<br>注解设置条件，所以，这里我们创建了两个实现Condition接口的类，它们分别<br>是LinuxCondition和WindowsCondition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinuxCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ConditionContext：判断条件能使用的上下文（环境）</span></span><br><span class="line"><span class="comment">    * AnnotatedTypeMetadata：当前标注了<span class="doctag">@Conditional</span>注解的注释信息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext context, </span></span></span><br><span class="line"><span class="function"><span class="params">    	AnnotatedTypeMetadata metadata)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断操作系统是否是Linux系统</span></span><br><span class="line">        <span class="comment">/* 1. 获取到bean的创建工厂（能获取到IOC容器使用到的BeanFactory，</span></span><br><span class="line"><span class="comment">        它就是创建对象以及进行装配的工厂）*/</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</span><br><span class="line">        <span class="comment">// 2. 获取到类加载器</span></span><br><span class="line">        ClassLoader classLoader = context.getClassLoader();</span><br><span class="line">        <span class="comment">/* 3. 获取当前环境信息，它里面就封装了我们这个当前运行时的一些信</span></span><br><span class="line"><span class="comment">        息，包括环境变量，以及包括虚拟机的一些变量*/</span></span><br><span class="line">        Environment environment = context.getEnvironment();</span><br><span class="line">        <span class="comment">// 4. 获取到bean定义的注册类</span></span><br><span class="line">        BeanDefinitionRegistry registry = context.getRegistry();</span><br><span class="line">        <span class="comment">/*在这儿还可以做更多的判断，比如说我判断一下Spring容器中是不是包含</span></span><br><span class="line"><span class="comment">        有某一个bean，就像下面这样，如果Spring容器中果真包含有名称为person</span></span><br><span class="line"><span class="comment">        的bean，那么就做些什么事情...*/</span></span><br><span class="line">        <span class="keyword">boolean</span> definition = registry.containsBeanDefinition(<span class="string">"person"</span>);</span><br><span class="line">        String property = environment.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="keyword">if</span> (property.contains(<span class="string">"linux"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过context 的getRegistry() 方法获取到的bean定义的注册对象，<br>实际是一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Spring容器中所有的bean都可以通过BeanDefinitionRegistry对象来进行注册</span></span><br><span class="line"><span class="comment">//因此我们可以通过它来查看Spring容器中到底注册了哪些bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanDefinitionRegistry</span> <span class="keyword">extends</span> <span class="title">AliasRegistry</span> </span>&#123;</span><br><span class="line">	<span class="comment">//向Spring容器中注册一个bean</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(String var1, BeanDefinition var2)</span> </span></span><br><span class="line"><span class="function">    	<span class="keyword">throws</span> BeanDefinitionStoreException</span>;</span><br><span class="line">    <span class="comment">//移除一个bean</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">    <span class="comment">//查询某一个bean的定义信息</span></span><br><span class="line">    <span class="function">BeanDefinition <span class="title">getBeanDefinition</span><span class="params">(String var1)</span> </span></span><br><span class="line"><span class="function">    	<span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line">    <span class="comment">//判断Spring容器中是否包含有某一个bean的定义</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsBeanDefinition</span><span class="params">(String var1)</span></span>;</span><br><span class="line">    String[] getBeanDefinitionNames();</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getBeanDefinitionCount</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isBeanNameInUse</span><span class="params">(String var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext context, </span></span></span><br><span class="line"><span class="function"><span class="params">    		AnnotatedTypeMetadata metadata)</span> </span>&#123;</span><br><span class="line">        Environment environment = context.getEnvironment();</span><br><span class="line">        String property = environment.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="keyword">if</span> (property.contains(<span class="string">"Windows"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后就需要在MainConfig2配置类中使用@Conditional注解添加条件了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Lazy</span></span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"给容器中添加咱们这个Person对象..."</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Conditional</span>(&#123;WindowsCondition<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line">	@Bean("bill")</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Bill Gates"</span>, <span class="number">62</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Conditional</span>(&#123;LinuxCondition<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line">	@Bean("linus")</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"linus"</span>, <span class="number">48</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外@Conditional注解也可以标注在类上，标注在类上的含义是：只<br>有满足了当前条件，这个配置类中配置的所有bean注册才能生效，也<br>就是对配置类中的组件进行统一设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对配置类中的组件进行统一设置</span></span><br><span class="line"><span class="comment">// 满足当前条件，这个类中配置的所有bean注册才能生效</span></span><br><span class="line"><span class="meta">@Conditional</span>(&#123;WindowsCondition<span class="class">.<span class="keyword">class</span>&#125;) </span></span><br><span class="line"><span class="class">@<span class="title">Configuration</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MainConfig2</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Lazy</span></span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"person"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"给容器中添加咱们这个Person对象..."</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"美美侠"</span>, <span class="number">25</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Bean</span>(<span class="string">"bill"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Bill Gates"</span>, <span class="number">62</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Conditional</span>(&#123;LinuxCondition<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line">	@Bean("linus")</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">person02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"linus"</span>, <span class="number">48</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们在运行IOCTest类中的test06()方法时，在Run Configurations<br>配置环境中VM options栏中设置一个-Dos.name=linux参数，将操作系统<br>模拟为了linux系统</p>
<h4 id="Conditional的扩展注解"><a href="#Conditional的扩展注解" class="headerlink" title="@Conditional的扩展注解"></a>@Conditional的扩展注解</h4><p><img src="/2020/02/28/Spring/7.jpg" alt></p>
<h4 id="Conditional与-Profile的对比"><a href="#Conditional与-Profile的对比" class="headerlink" title="@Conditional与@Profile的对比"></a>@Conditional与@Profile的对比</h4><p>Spring 3.0也有一些和@Conditional相似的注解，它们是Spring SPEL表达<br>式和Spring Profiles注解，但是Spring 4.0之后的@Conditional 注解要<br>比@Profile注解更加高级。@Profile注解用来加载应用程序的环境，该注解<br>仅限于根据预定义属性编写条件检查，而@Conditional注解则没有此限制</p>
<ol>
<li>Spring 3.0中的@Profile仅用于编写基于Environment变量的条件检查<br>。配置文件可用于基于环境加载应用程序配置</li>
<li>Spring 4.0之后的@Conditional注解允许开发人员为条件检查定义用户<br>定义的策略。此外@Conditional注解还可以用于条件bean注册</li>
</ol>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>下载jar包 spring-framework-4.3.9.RELEASE，基础项目需要使用如下jar包</p>
<ul>
<li>spring-aop.jar 开发AOP特性</li>
<li>spring-beans.jar 处理Bean</li>
<li>spring-context.jar 处理上下文</li>
<li>spring-core.jar 核心jar</li>
<li>spring-expression.jar spring表达式 EL/jtsl</li>
<li>coomons-logging.jar 增加第三方日志jar</li>
</ul>
<h3 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h3><p>配置文件applicationContext.xml，SprintBoot中对应的是application.yml</p>
<h3 id="IOC控制反转（依赖注入DI）"><a href="#IOC控制反转（依赖注入DI）" class="headerlink" title="IOC控制反转（依赖注入DI）"></a>IOC控制反转（依赖注入DI）</h3><p>在springIOC容器中创建对象并且给属性赋值，之后就可以直接拿取容器中的对象<br>，要求对象必需有无参构造器。对象的整个创建和销毁过程都是由Spring控制，我<br>门只需要从容器中获取对象即可，这就是控制反转</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  首先在配置文件中注册对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">lazy-init</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">包名+类名</span>&gt;</span> </span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以直接从容器中获取对象，两种方式的区别</p>
<ol>
<li>省略new</li>
<li>省略对象属性的赋值  </li>
<li>spring容器自动创建新对象并且自动赋值  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"><span class="comment">//以往创建对象</span></span><br><span class="line">Student stu=<span class="keyword">new</span> Student();</span><br><span class="line"><span class="comment">//spring上下文对象</span></span><br><span class="line">ApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">	<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="comment">//根据id获取对象</span></span><br><span class="line">Student stu=(Student)context.getBean(<span class="string">"student"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Spring对象的创建时间"><a href="#Spring对象的创建时间" class="headerlink" title="Spring对象的创建时间"></a>Spring对象的创建时间</h3><p>配置文件中可以配置一个个bean，默认在启动Spring的时候就会创建一个个<br>对象，并执行对象的初始化。bean中有一个属性lazy-init，默认情况时<br>default/false就表明在启动Spring的时候创建对象，如果是true的话<br>只会在getBean的时候创建对象，这样可以减少内存消耗</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  springioc容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">lazy-init</span>=<span class="string">"true"</span> <span class="attr">scope</span>=<span class="string">"singleton/prototype"</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">包名+类名</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 类的属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"fsd"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>bean中还有一个属性是scope，默认是singleton，表示这个类是单例类，也就是<br>说不管从容器中拿出多少个student，实际上拿出的是同一个student。如果指定<br>为prototype则说明会创建多例对象</p>
<h4 id="set注入"><a href="#set注入" class="headerlink" title="set注入"></a>set注入</h4><p>简单类型用value赋值，如果是对象类型用ref=”需要引用的id”,course依赖teacher<br>teacher从其他地方注入course中，赋值默认使用set方法，底层通过反射实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Teachre teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">teacher</span> <span class="attr">class</span>=<span class="string">"....Teacher"</span>&gt;</span> </span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">course</span> <span class="attr">class</span>=<span class="string">"....Course"</span>&gt;</span> </span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"teacher"</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">(<span class="keyword">int</span> age,String name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.age=age;</span><br><span class="line">	<span class="keyword">this</span>.name=name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">(<span class="keyword">int</span> number,String name,Teacher teacher)</span></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.number=number;</span><br><span class="line">	<span class="keyword">this</span>.name=name;</span><br><span class="line">	<span class="keyword">this</span>.teacher=teacher;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">teacher</span> <span class="attr">class</span>=<span class="string">"....Teacher"</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 如果顺序与构造器不一致可以用index/name/type 指定--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"20"</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"fsd"</span> <span class="attr">index</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">course</span> <span class="attr">class</span>=<span class="string">"....Course"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"111"</span> <span class="attr">name</span>=<span class="string">"number"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"fsfsd"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="p命名空间注入"><a href="#p命名空间注入" class="headerlink" title="p命名空间注入"></a>p命名空间注入</h3><p>在容器中引入p命名空间，xmlns:p=”<a href="http://wwww.springframework.org/scheam/p&quot;" target="_blank" rel="noopener">http://wwww.springframework.org/scheam/p&quot;</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">teacher</span> <span class="attr">class</span>=<span class="string">"....Teacher"</span> <span class="attr">p:age</span>=<span class="string">"20"</span> <span class="attr">p:name</span>=<span class="string">"vxc"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">course</span> <span class="attr">class</span>=<span class="string">"....Course"</span>&gt;</span> </span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">p:name</span>=<span class="string">"fsd"</span> <span class="attr">p:number</span>=<span class="string">"202"</span> <span class="attr">p:teacher-ref</span>=<span class="string">"teacher"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="注入各种数据类型"><a href="#注入各种数据类型" class="headerlink" title="注入各种数据类型"></a>注入各种数据类型</h3><p>List/Map/Set</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">All</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">	<span class="keyword">private</span> String[] array;</span><br><span class="line">	<span class="keyword">private</span> HashMap&lt;String,Object&gt; map;</span><br><span class="line">	<span class="keyword">private</span> HashSet&lt;String&gt; set;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"All"</span> <span class="attr">class</span>=<span class="string">"..."</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>dfs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>af<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>zv<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"array"</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">array</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">map</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">entry</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">key</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>fsda<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>fds<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">entry</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">key</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>fsda<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>fds<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="特殊值注入问题以及类型自动匹配"><a href="#特殊值注入问题以及类型自动匹配" class="headerlink" title="特殊值注入问题以及类型自动匹配"></a>特殊值注入问题以及类型自动匹配</h2><p>value中表示符号</p>
<ul>
<li>&lt; 变为 &amp;lt;</li>
<li>&amp; 变为 &amp;amp;</li>
<li>&gt; 变为 &amp;gt;</li>
</ul>
<h3 id="自动装配（只适用于引用类型）"><a href="#自动装配（只适用于引用类型）" class="headerlink" title="自动装配（只适用于引用类型）"></a>自动装配（只适用于引用类型）</h3><p>约定优于配置,不需要在bean中配置，能够自动找到引用，course类中有一个<br>teacher属性，ioc容器中有一个id为teachar的bean，id值=属性名。可以头<br>文件全局设置default-autowire=””,自动装配可以减少代码量但是降低可读性</p>
<ul>
<li>byName</li>
<li>byType 根据bean类型自动装配，弊端是有两个teacher会报错</li>
<li>constructor bean类型是否与构造方法参数类型一致，本质是byType</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"course"</span> <span class="attr">class</span>=<span class="string">"....Course"</span> <span class="attr">autowire</span>=<span class="string">"byName"</span>&gt;</span> </span><br><span class="line">	...</span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;property name="teacher" ref="teacher"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>通过注解的形式将bean以及相应的属性值放入ioc容器，用于简化配置</p>
<h3 id="配置扫描器"><a href="#配置扫描器" class="headerlink" title="配置扫描器"></a>配置扫描器</h3><p>将要扫描的包放入扫描器，扫描器会扫描该包下的所有类如果发现有注解就会将<br>其放入ioc容器中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:componetn-scan</span> <span class="attr">base-package</span>=<span class="string">"org.lanqiao.bao,..."</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">context:componetn-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h4><p>应用于bean属性的setter方法，表明受影响的bean属性在配置时必须放在<br>XML配置文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="meta">@Required</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.age = age;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Required</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"student"</span> <span class="attr">class</span>=<span class="string">"com.tutorialspoint.Student"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>  <span class="attr">value</span>=<span class="string">"Zara"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span>  <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h4><p>它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		如果有name属性，就会按照id进行匹配，如果</span></span><br><span class="line"><span class="comment">		没有name属性，默认会按照属性的名称进行匹配，</span></span><br><span class="line"><span class="comment">		如果属性名称不匹配则会按照class类型进行匹配</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="meta">@Resource</span>(name=<span class="string">"student"</span>)</span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="Qualifier"></a>Qualifier</h4><p>这个注解跟Autowired配合使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//相当于Resource</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"name"</span>)</span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用注解声明事务"><a href="#使用注解声明事务" class="headerlink" title="使用注解声明事务"></a>使用注解声明事务</h4><p>通过事务使所有方法(例如增删查改)全部成功或者失败 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使add方法变为一个事务，方法中的内容要么都执行要么都不执行</span></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly=<span class="keyword">false</span>,propagation=Propagation.REQUIRED)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP面向切面编程"><a href="#AOP面向切面编程" class="headerlink" title="AOP面向切面编程"></a>AOP面向切面编程</h2><p>比如有几个方法含有一些相同代码，如果把这些代码抽成一个方法，这就是面<br>向对象编程，如果这个方法改名字那么所有引用这个方法的地方都要改名字，<br>如果这个方法因为逻辑要改变位置那么所有引用这个方法的地方都要进行修<br>改。以上问题可以用AOP解决。根据以上如果许多方法需要使用这个抽取的方<br>法，不需要写在那些方法中，直接切入那些方法中，如果修改抽取方法的名<br>字或位置时不需要修改，因为这些方法并没有引用</p>
<h3 id="切入点与切面"><a href="#切入点与切面" class="headerlink" title="切入点与切面"></a>切入点与切面</h3><p>切入点定义抽取方法在哪个位置执行，切面就是抽取方法切到切入点</p>
<h3 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h3><ol>
<li>前置通知<br>在切入点add方法执行之前插入的通知</li>
<li>后置通知<br>在切入点add方法执行之后插入的通知</li>
<li>异常通知<br>在切入点add方法抛出异常时插入的通知</li>
<li>环绕通知<br>可以贯穿切入点add方法执行的通知</li>
<li>最终通知<br>当切入点add方法执行完毕插入的通知（不论正常还是异常）</li>
</ol>
<h3 id="类变为通知"><a href="#类变为通知" class="headerlink" title="类变为通知"></a>类变为通知</h3><p>需要通过配置将通知与切入点关联，通知类与切入类都需放入ioc容器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=</span></span><br><span class="line"><span class="tag">		"</span></span><br><span class="line"><span class="tag">		<span class="attr">execution</span>(<span class="attr">public</span> <span class="attr">void</span> <span class="attr">org.lanqiao.service.Stu.add</span>(<span class="attr">org..Student</span>)) </span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(<span class="attr">public</span> <span class="attr">void</span> <span class="attr">add</span>(<span class="attr">org..Student</span>))</span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(<span class="attr">public</span> * <span class="attr">add</span>(<span class="attr">org..Student</span>))</span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(<span class="attr">public</span> <span class="attr">void</span> *(<span class="attr">org..Student</span>))</span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(<span class="attr">public</span> <span class="attr">void</span> <span class="attr">add</span>(<span class="attr">..</span>))</span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(* <span class="attr">org.lanqiao.service.Stu.</span>*<span class="attr">.</span>*(<span class="attr">..</span>))</span></span><br><span class="line"><span class="tag">		<span class="attr">or</span> <span class="attr">execution</span>(* <span class="attr">org.lanqiao.service.Stu..</span>*<span class="attr">.</span>*(<span class="attr">..</span>))</span></span><br><span class="line"><span class="tag">		" </span></span><br><span class="line"><span class="tag">		<span class="attr">id</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"printm"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut/&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;/aop:config&gt;</span></span></span><br></pre></td></tr></table></figure>
<ol>
<li>实现接口</li>
</ol>
<ul>
<li>前置通知 MethodBeforeAdvice before(Method method,Object[] args,<br>Object target)</li>
<li>后置通知 AfterReturningAdvice afterReturning(Object returnValue,<br>Method method,Object[] args,Object target) target就是调用切入点的对象，<br>method就是切入点，args就是好切入点参数，切入点返回值</li>
<li>异常通知 ThrowsAdvice afterThrowing(Method method,Object[] args,<br>Object target,Throwable ex)，是public方法</li>
<li>环绕通知 可以包含前置后置异常最终，可以获取目标方法的全部控制权<br>（目标方法是否执行、执行之前、执行之后、参数、返回值）<br>MethodInterceptor，底层是拦截器<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="comment">//前置通知</span></span><br><span class="line">		System.out.println(<span class="string">"用环绕通知实现的前置通知"</span>);</span><br><span class="line">		<span class="comment">//控制目标方法的执行,如果不写则不会执行目标方法add,但是通知会执行</span></span><br><span class="line">		Object result=invocation.proceed(); <span class="comment">//接收返回值</span></span><br><span class="line">		<span class="comment">//后置通知</span></span><br><span class="line">		System.out.println(<span class="string">"用环绕通知实现的后置通知"</span>);</span><br><span class="line">		System.out.println(<span class="string">"target="</span>+invocation.getThis()+</span><br><span class="line">		<span class="string">"method="</span>+invocation.getMethod()+<span class="string">"args="</span>+</span><br><span class="line">		invocation.getArguments());</span><br><span class="line">	&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		<span class="comment">//异常通知</span></span><br><span class="line">		System.out.println(<span class="string">"用环绕通知实现的异常通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="基于注解形式的AOP"><a href="#基于注解形式的AOP" class="headerlink" title="基于注解形式的AOP"></a>基于注解形式的AOP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"logann"</span>) <span class="comment">//加入ioc容器</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//变为通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAnn</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	(<span class="string">"execution(public void org.lanqiao.service.Stu.add(org..Student))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint jp)</span></span>&#123; <span class="comment">//获取目标对象</span></span><br><span class="line">		System.out.println(<span class="string">"注解形式的前置通知"</span>);</span><br><span class="line">		System.out.println(<span class="string">"target"</span>+jp.getTarget()+<span class="string">"method"</span>+</span><br><span class="line">		jp.getSignature()+<span class="string">"args"</span>+jp.getArgs());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果有返回值需要声明返回值参数名</span></span><br><span class="line">	<span class="meta">@AfterReturning</span></span><br><span class="line">	(pointcut=</span><br><span class="line">	<span class="string">"execution(public void org.lanqiao.service.Stu.add(org..Student))"</span></span><br><span class="line">	,returning=<span class="string">"returningValue"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint jp,Object returningValue)</span></span>&#123;</span><br><span class="line">		Sysetm.out.println(<span class="string">"注解形式的后置通知"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Around</span></span><br><span class="line">	(<span class="string">"execution(public void org.lanqiao.service.Stu.add(org..Student))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAround</span><span class="params">(ProceedingJoinPoint jp)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			jp.proceed();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Throwable ex)&#123;</span><br><span class="line"></span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//最终通知</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@AfterThrowing</span></span><br><span class="line">	(<span class="string">"execution(public void org.lanqiao.service.Stu.add(org..Student))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> vid <span class="title">myException</span><span class="params">(JoinPoint jp,NullPointerException ex)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"捕获特定异常"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	(<span class="string">"execution(public void org.lanqiao.service.Stu.add(org..Student))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="spring开发web项目"><a href="#spring开发web项目" class="headerlink" title="spring开发web项目"></a>spring开发web项目</h2><p>springioc容器初始化，在Java程序中new ClassPath…</p>
<ul>
<li>将IOC容器中的所有bean实例化为对象</li>
<li>将各个bean依赖的属性值注入进去</li>
</ul>
<h3 id="web程序初始化IOC容器"><a href="#web程序初始化IOC容器" class="headerlink" title="web程序初始化IOC容器"></a>web程序初始化IOC容器</h3><p>web程序中没有统一的入口，如果很多类需要使用容器那么每个类中都要实例<br>化容器，耗费性能，启动web项目时可以通过监听器将IOC容器实例化</p>
<h3 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h3><p>spring-web.jar中有写好的监听器，在web.xml中加载监听器,服务器启动时<br>会执行监听器默认springioc配置文件名为applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener.class</span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="拆分配置文件"><a href="#拆分配置文件" class="headerlink" title="拆分配置文件"></a>拆分配置文件</h3><h4 id="Java项目"><a href="#Java项目" class="headerlink" title="Java项目"></a>Java项目</h4><ul>
<li>applciationContext1.xml</li>
<li>applciationContext2.xml</li>
<li>applciationContext3.xml  </li>
</ul>
<h4 id="web项目"><a href="#web项目" class="headerlink" title="web项目"></a>web项目</h4><p>合并多个配置文件,在web.xml中指定,可以拿取IOC容器  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span> </span><br><span class="line">		classpath:applicationContext-Dao.xml,</span><br><span class="line">		classpath:applicationContext-*.xml,</span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以在主配置文件中引入子配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext-Dao.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext-*.xml"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="常用注解总结"><a href="#常用注解总结" class="headerlink" title="常用注解总结"></a>常用注解总结</h2><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>这个注解是Spring Boot 项目的基石，创建SpringBoot 项目之后会默<br>认在主类加上，标注在某个类上就说明该类是主配置类，运行该类main<br>方法启动应用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldMainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以把该注解看作是 @Configuration、@EnableAutoConfiguration<br>、@ComponentScan 注解的集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">), @<span class="title">Filter</span>(</span></span><br><span class="line"><span class="class">    <span class="title">type</span> </span>= FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">)&#125;</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据SpringBoot 官网，这三个注解的作用分别是：</p>
<ol>
<li>@EnableAutoConfiguration：启用SpringBoot 的自动配置机制</li>
<li>@ComponentScan： 扫描被@Component (@Service,@Controller)注解<br>的 bean，注解默认会扫描该类所在的包下所有的类</li>
<li>@Configuration：允许在Spring 上下文中注册额外的bean 或导入其他<br>配置类</li>
</ol>
<h3 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h3><p>自动导入对象到类中，被注入进的类同样要被Spring 容器管理比如：<br>Service 类注入到Controller 类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		如果Student的实现类只有一个，那么相当于</span></span><br><span class="line"><span class="comment">		Student student=new Studentimpl();</span></span><br><span class="line"><span class="comment">		如果Student实现类有多个，则会按照属性名称</span></span><br><span class="line"><span class="comment">		进行匹配</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Component-Repository-Service-Controller"><a href="#Component-Repository-Service-Controller" class="headerlink" title="Component,@Repository,@Service, @Controller"></a>Component,@Repository,@Service, @Controller</h3><p>我们一般使用 @Autowired 注解让Spring 容器帮我们自动装配 bean。要<br>想把类标识成可用于@Autowired 注解自动装配的bean 的类，可以采用以<br>下注解实现：</p>
<ol>
<li>@Component ：通用的注解，可标注任意类为 Spring 组件。如果一个<br>Bean 不知道属于哪个层，可以使用@Component 注解标注</li>
<li>@Repository : 对应持久层即Dao 层，主要用于数据库相关操作</li>
<li>@Service : 对应服务层，主要涉及一些复杂的逻辑，需要用到Dao层</li>
<li>@Controller : 对应Spring MVC 控制层，主要用户接受用户请求并<br>调用Service 层返回数据给前端页面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//默认id是dao</span></span><br><span class="line"><span class="comment">//也可以自定义id @Component("dd")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dao</span></span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span> <span class="comment">//byType类型的自动装配</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"teacher"</span>) <span class="comment">//byName自动装配按照id</span></span><br><span class="line">			<span class="keyword">private</span> Teacher teacher;</span><br><span class="line">	&#125;</span><br><span class="line">	ApplicationContext context =</span><br><span class="line">               <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    Dao person = (Dao)context.getBean(<span class="string">"dao"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>@RestController 注解是@Controller 和@ResponseBody 的合集，<br>表示这是个控制器bean，并且是将函数的返回值直接填入HTTP 响应<br>体中，是REST 风格的控制器，返回 JSON 或 XML 形式数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//能够处理请求</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ResponseBody</span> <span class="comment">//能够直接将数据返回，也可以写在类上面</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>) <span class="comment">//接收来自浏览器的hello请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h3><p>声明Spring Bean 的作用域，使用方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personsingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>四种常见的Spring Bean 的作用域：</p>
<ol>
<li>singleton : 唯一bean 实例，Spring 中的bean 默认都是单例的</li>
<li>prototype : 每次请求都会创建一个新的bean 实例</li>
<li>request : 每一次HTTP 请求都会产生一个新的bean，该bean 仅<br>在当前 HTTP request 内有效</li>
<li>session : 每一次HTTP 请求都会产生一个新的 bean，该 bean<br>仅在当前 HTTP session 内有效</li>
</ol>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><p>一般用来声明配置类，可以使用 @Component 注解替代，不过使用<br>Configuration 注解声明配置类更加语义化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Person <span class="title">personsingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Personimpl();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Get-请求"><a href="#Get-请求" class="headerlink" title="Get 请求"></a>Get 请求</h3><p>@GetMapping(“users”) 等价于 @RequestMapping(value=”/users”,<br>method=RequestMethod.GET)，请求从服务器获取特定资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;User&gt;&gt; getAll()&#123;</span><br><span class="line">	<span class="keyword">return</span> user.findall();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="POST-请求"><a href="#POST-请求" class="headerlink" title="POST 请求"></a>POST 请求</h3><p>@PostMapping(“users”) 等价于 @RequestMapping(value=”/users”,<br>method=RequestMethod.POST)，在服务器上创建一个新的资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">createUser</span><span class="params">(@Valid @RequestBody User user)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> user.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PUT-请求"><a href="#PUT-请求" class="headerlink" title="PUT 请求"></a>PUT 请求</h3><p>@PutMapping(“/users/{userId}”) 等价于 @RequestMapping(<br>value=”/users/{userId}”,method=RequestMethod.PUT)，更<br>新服务器上的资源（客户端提供更新后的整个资源）。举个例子：<br>PUT /users/12（更新编号为 12 的学生）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span>(<span class="string">"/users/&#123;userId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">updateUser</span><span class="params">(@PathVariable(value=<span class="string">"userId"</span>)</span></span></span><br><span class="line"><span class="function">	Long userid,@Valid @RequestBody User user)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DELETE-请求"><a href="#DELETE-请求" class="headerlink" title="DELETE 请求"></a>DELETE 请求</h3><p>@DeleteMapping(“/users/{userId}”) 等价于 @RequestMapping(<br>value=”/users/{userId}”,method=RequestMethod.DELETE)，从<br>服务器删除特定的资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"/users/&#123;userId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">deleteUser</span><span class="params">(@PathVariable(value=<span class="string">"userId"</span>)</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PATCH-请求"><a href="#PATCH-请求" class="headerlink" title="PATCH 请求"></a>PATCH 请求</h3><p>更新服务器上的资源（客户端提供更改的属性，可以看做作是部分更新）,<br>一般实际项目中，我们都是PUT不够用了之后才用PATCH请求去更新数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PatchMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">updateUser</span><span class="params">(@RequestBody User user)</span></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PathVariable-和-RequestParam"><a href="#PathVariable-和-RequestParam" class="headerlink" title="@PathVariable 和 @RequestParam"></a>@PathVariable 和 @RequestParam</h3><p>@PathVariable用于获取路径参数，@RequestParam用于获取查询参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">//使类变为控制器</span></span><br><span class="line"><span class="comment">//SpringMvcHan/welcome/abc?type=web</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"Spring"</span>) <span class="comment">//映射路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcHandler</span></span>&#123; </span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"welcome/&#123;name&#125;"</span>) </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">welcome</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		@PathVariable(<span class="string">"name"</span>)</span> String name,</span></span><br><span class="line"><span class="function">		@<span class="title">RequestParam</span><span class="params">(value=<span class="string">"uage"</span>,required=<span class="keyword">false</span>,defaultValue=<span class="string">"23"</span>)</span> </span></span><br><span class="line"><span class="function">		String type)</span>&#123;</span><br><span class="line">		..</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p>用于读取Request 请求（可能是POST,PUT,DELETE,GET 请求）的body<br>部分并且Content-Type 为 application/json 格式的数据，接收到<br>数据之后会自动将数据绑定到 Java 对象上去。<br>系统会使用HttpMessageConverter 或者自定义的HttpMessageConverter<br>将请求的body 中的json 字符串转换为java 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">updateUser</span><span class="params">(@RequestBody User user)</span></span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> String fullName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们发送post 请求到这个接口，并且body 携带JSON 数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"coder"</span>,<span class="attr">"fullName"</span>:<span class="string">"shuangkou"</span>,<span class="attr">"password"</span>:<span class="string">"123456"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们的后端就可以直接把json 格式的数据映射到我们的User 类上，<br>需要注意的是：一个请求方法只可以有一个@RequestBody，但是可以有<br>多个@RequestParam和@PathVariable。<br>如果你的方法必须要用两个 @RequestBody来接受数据的话，大概率是你<br>的数据库设计或者系统设计出问题了</p>
<h3 id="读取配置信息"><a href="#读取配置信息" class="headerlink" title="读取配置信息"></a>读取配置信息</h3><p>很多时候我们需要将一些常用的配置信息比如阿里云 oss、发送短信、微信<br>认证的相关配置信息等等放到配置文件中。比如 application.yml 中</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wuhan2020:</span> <span class="string">武汉加油！中国加油！</span></span><br><span class="line"></span><br><span class="line"><span class="attr">my-profile:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Guide哥</span></span><br><span class="line">  <span class="attr">email:</span> <span class="string">koushuangbwcx@163.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">library:</span></span><br><span class="line">  <span class="attr">location:</span> <span class="string">湖北武汉加油中国加油</span></span><br><span class="line">  <span class="attr">books:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">天才基本法</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">二十二岁的林朝夕在父亲确诊阿尔茨海默病这天</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">时间的秩序</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">为什么我们记得过去，而非未来？时间“流逝”意味着什么？</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">了不起的我</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">如何养成一个新习惯？如何让心智变得更成熟？如何拥有高质量的关系？</span></span><br></pre></td></tr></table></figure>

<h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><p>使用@Value(“${property}”) 读取比较简单的配置信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;wuhan2020&#125;"</span>)</span><br><span class="line">String wuhan;</span><br></pre></td></tr></table></figure>

<h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h3><p>通过@ConfigurationProperties 读取配置信息并与bean 绑定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"library"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">libraryproperties</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String location;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>&#123;</span><br><span class="line">		String name;</span><br><span class="line">		String description;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PropertySource"><a href="#PropertySource" class="headerlink" title="PropertySource"></a>PropertySource</h3><p>@PropertySource 读取指定properties 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line">PropertySource(<span class="string">"classpath:website.properties"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">libraryproperties</span></span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;wuhan2020&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a>参数校验</h3><p>数据的校验的重要性就不用说了，即使在前端对数据进行校验的情况下，<br>我们还是要对传入后端的数据再进行一遍校验，避免用户绕过浏览器直<br>接通过一些HTTP 工具直接向后端请求一些违法数据。校验的时候我们<br>实际用的是Hibernate Validator 框架</p>
<h3 id="一些常用的字段验证的注解"><a href="#一些常用的字段验证的注解" class="headerlink" title="一些常用的字段验证的注解"></a>一些常用的字段验证的注解</h3><ul>
<li>@NotEmpty 被注释的字符串的不能为 null 也不能为空</li>
<li>@NotBlank 被注释的字符串非 null，并且必须包含一个非空白字符</li>
<li>@Null 被注释的元素必须为 null</li>
<li>@NotNull 被注释的元素必须不为 null</li>
<li>@AssertTrue 被注释的元素必须为 true</li>
<li>@AssertFalse 被注释的元素必须为 false</li>
<li>@Pattern(regex=,flag=)被注释的元素必须符合指定的正则表达式</li>
<li>@Email 被注释的元素必须是 Email 格式。</li>
<li>@Min(value)被注释的元素必须是一个数字，其值必须大于等于指定<br>的最小值</li>
<li>@Max(value)被注释的元素必须是一个数字，其值必须小于等于指定<br>的最大值</li>
<li>@DecimalMin(value)被注释的元素必须是一个数字，其值必须大于等<br>于指定的最小值</li>
<li>@DecimalMax(value) 被注释的元素必须是一个数字，其值必须小于<br>等于指定的最大值</li>
<li>@Size(max=, min=)被注释的元素的大小必须在指定的范围内</li>
<li>@Digits (integer, fraction)被注释的元素必须是一个数字，其值<br>必须在可接受的范围内</li>
<li>@Past被注释的元素必须是一个过去的日期</li>
<li>@Future 被注释的元素必须是一个将来的日期</li>
</ul>
<p>我们在需要验证的参数上加上了@Valid注解，如果验证失败，它将抛出<br>MethodArgumentNotValidException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">createUser</span><span class="params">(@Valid @RequestBody User user)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> user.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证请求参数"><a href="#验证请求参数" class="headerlink" title="验证请求参数"></a>验证请求参数</h3><p>一定一定不要忘记在类上加上Validated 注解了，这个参数可以告诉<br>Spring 去校验方法参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">createUser</span><span class="params">(@Valid @PathVariable(<span class="string">"id"</span>)</span></span></span><br><span class="line"><span class="function">	@<span class="title">Max</span><span class="params">(<span class="number">5</span>,message=)</span>)</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全局处理Controller-层异常"><a href="#全局处理Controller-层异常" class="headerlink" title="全局处理Controller 层异常"></a>全局处理Controller 层异常</h3><p>介绍一下我们Spring 项目必备的全局处理Controller 层异常</p>
<ol>
<li>@ControllerAdvice :注解定义全局异常处理类</li>
<li>@ExceptionHandler :注解声明异常处理方法</li>
</ol>
<p>如何使用呢？拿我们在参数校验这块来举例子。如果方法参数不对的话就<br>会抛出MethodArgumentNotValidException，我们来处理这个异常</p>
<h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>在要开启事务的方法上使用@Transactional注解即可!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(rollbackFor=Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">void</span> <span class="title">save</span>()</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Exception 分为运行时异常 RuntimeException 和非运行时异常。在<br>@Transactional注解中如果不配置rollbackFor 属性,那么事物只会<br>在遇到 RuntimeException 的时候才会回滚，加上rollbackFor=<br>Exception.class，可以让事物在遇到非运行时异常时也回滚。<br>@Transactional 注解一般用在可以作用在类或者方法上</p>
<ol>
<li>作用于类：当把@Transactional 注解放在类上时，表示所有该类的<br>public 方法都配置相同的事务属性信息</li>
<li>作用于方法：类配置@Transactional，方法也配置@Transactional<br>，方法的事务会覆盖类的事务配置信息</li>
</ol>
<h3 id="测试相关"><a href="#测试相关" class="headerlink" title="测试相关"></a>测试相关</h3><p>@ActiveProfiles一般作用于测试类上， 用于声明生效的Spring配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = RANDOM_PORT)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBase</span> </span>&#123;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>@Test声明一个方法为测试方法</li>
<li>@Transactional被声明的测试方法的数据会回滚，避免污染测试数据</li>
<li>@WithMockUser Spring Security提供的，用来模拟一个真实用户<br>，并且可以赋予权限</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@WithMockUser</span>(username = <span class="string">"user-id-18163138155"</span>, authorities = <span class="string">"ROLE_TEACHER"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">should_import_student_success</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">高明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://skysea-gaoming.github.io/2020/02/28/Spring/">https://skysea-gaoming.github.io/2020/02/28/Spring/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/28/SpringMvc/"><i class="fa fa-chevron-left">  </i><span>SpringMVC</span></a></div><div class="next-post pull-right"><a href="/2020/02/28/Algorithm/"><span>Algorithm</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://skysea-gaoming.github.io/2020/02/28/Spring/';
  this.page.identifier = '2020/02/28/Spring/';
  this.page.title = 'Spring';
}
var d = document, s = d.createElement('script');
s.src = "https://" + '你的disqus的 short-name' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://你的disqus的 short-name.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By 高明</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>