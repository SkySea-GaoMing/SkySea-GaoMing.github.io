<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="MySQL"><meta name="keywords" content="DataBase"><meta name="author" content="高明"><meta name="copyright" content="高明"><title>MySQL | SkySea-GaoMing</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql概述"><span class="toc-number">2.</span> <span class="toc-text">Mysql概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库基本概念"><span class="toc-number">2.1.</span> <span class="toc-text">数据库基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关系模型"><span class="toc-number">2.2.</span> <span class="toc-text">关系模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL"><span class="toc-number">2.3.</span> <span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL使用"><span class="toc-number">2.4.</span> <span class="toc-text">MySQL使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL基本命令"><span class="toc-number">2.5.</span> <span class="toc-text">MySQL基本命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DQL"><span class="toc-number">3.</span> <span class="toc-text">DQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库函数"><span class="toc-number">3.1.</span> <span class="toc-text">数据库函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单行函数"><span class="toc-number">3.1.1.</span> <span class="toc-text">单行函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分组和组函数"><span class="toc-number">3.2.</span> <span class="toc-text">分组和组函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多表连接查询"><span class="toc-number">3.3.</span> <span class="toc-text">多表连接查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#子查询"><span class="toc-number">3.4.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集合运算"><span class="toc-number">3.5.</span> <span class="toc-text">集合运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DML"><span class="toc-number">4.</span> <span class="toc-text">DML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL"><span class="toc-number">5.</span> <span class="toc-text">DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常见约束"><span class="toc-number">5.1.</span> <span class="toc-text">常见约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引"><span class="toc-number">5.2.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#索引的使用"><span class="toc-number">5.2.1.</span> <span class="toc-text">索引的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引的分类"><span class="toc-number">5.2.2.</span> <span class="toc-text">索引的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引操作"><span class="toc-number">5.2.3.</span> <span class="toc-text">索引操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图"><span class="toc-number">5.3.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limit"><span class="toc-number">5.4.</span> <span class="toc-text">limit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务TCL"><span class="toc-number">6.</span> <span class="toc-text">事务TCL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#事务的创建"><span class="toc-number">6.1.</span> <span class="toc-text">事务的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete和truncate在事务中的区别"><span class="toc-number">6.2.</span> <span class="toc-text">delete和truncate在事务中的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程和函数"><span class="toc-number">7.</span> <span class="toc-text">存储过程和函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#存储过程"><span class="toc-number">7.1.</span> <span class="toc-text">存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数模式"><span class="toc-number">7.2.</span> <span class="toc-text">参数模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-number">7.3.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#游标"><span class="toc-number">7.4.</span> <span class="toc-text">游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#触发器"><span class="toc-number">7.5.</span> <span class="toc-text">触发器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#窗口函数"><span class="toc-number">8.</span> <span class="toc-text">窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#窗口函数的作用"><span class="toc-number">8.1.</span> <span class="toc-text">窗口函数的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#窗口函数的使用"><span class="toc-number">8.2.</span> <span class="toc-text">窗口函数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rank"><span class="toc-number">8.2.1.</span> <span class="toc-text">rank</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他专业窗口函数"><span class="toc-number">8.2.2.</span> <span class="toc-text">其他专业窗口函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#聚合函数作为窗口函数"><span class="toc-number">8.2.3.</span> <span class="toc-text">聚合函数作为窗口函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql三范式"><span class="toc-number">9.</span> <span class="toc-text">Mysql三范式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一范式"><span class="toc-number">9.1.</span> <span class="toc-text">第一范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二范式"><span class="toc-number">9.2.</span> <span class="toc-text">第二范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三范式"><span class="toc-number">9.3.</span> <span class="toc-text">第三范式</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2762516417,1589137703&amp;fm=26&amp;gp=0.jpg"></div><div class="author-info__name text-center">高明</div><div class="author-info__description text-center">JAVA工程师</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">85</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">17</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SkySea-GaoMing</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">MySQL</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/">后端技术</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2020/02/28/Mysql/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2020/02/28/Mysql/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>参考《数据库系统概论》 尚硅谷Mysql教程</p>
<h2 id="Mysql概述"><a href="#Mysql概述" class="headerlink" title="Mysql概述"></a>Mysql概述</h2><p>MySQL是最流行的关系型数据库管理系统，数据库（Database）是按照数据结<br>构来组织、存储和管理数据的仓库，所谓的关系型数据库，是建立在关系模型<br>基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据</p>
<h3 id="数据库基本概念"><a href="#数据库基本概念" class="headerlink" title="数据库基本概念"></a>数据库基本概念</h3><ol>
<li>Data 描述事物的符号记录</li>
<li>DB(database) 存储数据的仓库，保存一系列有组织的数据</li>
<li>DBMS(Database Management System) 可以操纵DB</li>
<li>DBS DB和DBMS的总体描述</li>
</ol>
<h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><p>关系模型由一组关系组成，每个关系的数据结构是一张规范化的二维表，<br>一般的描述方式为 关系名（属性1，属性2，···，属性n），关系的每<br>一个属性值都必须是一个不可分的数据项，也就是说不允许表中还有表<br>，关系模型的数据操纵主要包括查询、插入、删除和更新，这些操作都<br>需要满足关系的完整性约束条件</p>
<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>结构化查询语言(Structured Query Language)是关系数据库的标准语<br>言，包括查询、数据库模式创建、数据的删除修改等一些列功能，SQL语句<br>不区分大小写</p>
<ul>
<li>DQL 查询语句 主要由select组成</li>
<li>DML 数据操作语言，主要由insert、update和delete组成</li>
<li>DDL 数据定义语言，主要由create、alter、drop和truncate组成</li>
<li>DCL 数据控制语言，主要由grant和revoke组成</li>
<li>TCL 事务控制语句 主要由commit、rollback和savepoint组成</li>
</ul>
<h3 id="MySQL使用"><a href="#MySQL使用" class="headerlink" title="MySQL使用"></a>MySQL使用</h3><p><img src="/2020/02/28/Mysql/number1.jpg" alt></p>
<h3 id="MySQL基本命令"><a href="#MySQL基本命令" class="headerlink" title="MySQL基本命令"></a>MySQL基本命令</h3><p>默认以分号作为命令结束</p>
<ol>
<li>显示所有数据库，mysql保存用户信息，information_schema保存原数据  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| gaoming            |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sakila             |</span><br><span class="line">| sys                |</span><br><span class="line">| world              |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br></pre></td></tr></table></figure></li>
<li>切换数据库<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use gaoming;</span><br></pre></td></tr></table></figure></li>
<li>显示数据库中的所有表，如果没进入gaoming则需要加from gaoming<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">| Tables_in_gaoming |</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">| gao               |</span><br><span class="line">| person            |</span><br><span class="line">+<span class="comment">-------------------+</span></span><br></pre></td></tr></table></figure></li>
<li>查看当前处于哪个数据库<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| database() |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| gaoming    |</span><br><span class="line">+<span class="comment">------------+</span></span><br></pre></td></tr></table></figure></li>
<li>创建一个表<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> suinfo(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>));</span><br></pre></td></tr></table></figure></li>
<li>查看表结构<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc suinfo;</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id    | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br></pre></td></tr></table></figure></li>
<li>查看所有数据<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from suinfo;</span><br></pre></td></tr></table></figure></li>
<li>插入数据<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into suinfo(id,name) values(1,'john');</span><br></pre></td></tr></table></figure></li>
<li>修改数据<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">col</span> <span class="built_in">CHAR</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="keyword">col</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> mytable</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">col</span> = val</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li>
<li>删除数据<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from suinfo where id=1;</span><br></pre></td></tr></table></figure></li>
<li>查看数据库版本，或者在cmd中输入 mysql –version<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 8.0.16    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br></pre></td></tr></table></figure></li>
<li>SQL语句本身不区分大小写，Windows中字段和值也不区分大小写<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注释</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> mytable; <span class="comment">-- 注释</span></span><br><span class="line"><span class="comment">/* 注释1</span></span><br><span class="line"><span class="comment">   注释2 */</span></span><br></pre></td></tr></table></figure></li>
<li>主键的值是可以修改或者复用的，但是一般不这样</li>
</ol>
<h2 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h2><p>select的功能就是查询数据，不仅可以单表查询，也可以多表连接查询，还<br>可以进行子查询。select后的列表用于确定选择哪些列，where条件用于确<br>定选择哪些行，如果没有where条件默认选出所有行</p>
<ol>
<li>基础查询<br>查询列表可以是表中的字段、常量、表达式、函数，查询结果是虚拟表单。<br>特殊字段可以加着重号`<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">#查询特定列</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">#可以增加where条件</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
可以给字段起别名<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">as</span> iid,<span class="keyword">name</span> <span class="keyword">as</span> mane <span class="keyword">from</span> suinfo;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| iid  | mane |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 | ui   |</span><br><span class="line">|    2 | op   |</span><br><span class="line">+<span class="comment">------+------+</span></span><br></pre></td></tr></table></figure>
当使用select语句进行查询时，可以在语句中使用算术运算符形成算术表达式</li>
</ol>
<ul>
<li>对数值型数据列、变量、常量可以使用算术运算符</li>
<li>对日期型数据列、变量、常量可以使用算术运算符</li>
<li>可以在两个数据列之间使用算术运算符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>+<span class="number">5</span> <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span>*<span class="number">3</span>&gt;<span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>MySQL中不能用+将字符串连接起来，而是使用concat连接字符串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(username,<span class="string">'xx'</span>) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">#如果连接运算中出现null，则会导致连接后的结果也是null</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(username,<span class="literal">null</span>) <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">#可以为数据列起一个别名</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(username,<span class="string">'xx'</span>) <span class="keyword">as</span> tt <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">#也可以同时为多列和表起别名</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(username,<span class="string">'xx'</span>) <span class="keyword">as</span> tt,username <span class="keyword">as</span> uu <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">as</span> tr;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>去除字段组合的重复值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>where子句可以控制只选择指定的行，该子句包含的是一个条件表达式，<br>所以可以使用基本的比较运算符，不仅可以比较数值的大小，也可以比较<br>字符串和日期，判断相等是=，不等是&lt;&gt;，赋值是:=  <img src="/2020/02/28/Mysql/4.jpg" alt></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">7</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="number">2</span> <span class="keyword">between</span> <span class="keyword">id</span> <span class="keyword">and</span> teid;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="number">2</span> <span class="keyword">in</span>(<span class="keyword">id</span>,teid);</span><br></pre></td></tr></table></figure>
</li>
<li><p>like主要用于模糊查询，SQL语句中可以使用两个通配符，一个是_，表<br>示一个任意字符，另一个是%，表示任意多个字符，[]可匹配集合内的字符<br>，^可以表示否定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以l开头的所有name</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'l%'</span>;</span><br><span class="line"><span class="comment">#name为两个字符</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'__'</span>;</span><br><span class="line"><span class="comment">#使用转义字符，name以_开头</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'\_%'</span>;</span><br><span class="line"><span class="comment">#前者可能为null的话就不会查询出来，后者查询所有</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employes <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'%%'</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employes;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mytable <span class="keyword">WHERE</span> <span class="keyword">col</span> <span class="keyword">LIKE</span> <span class="string">'[^AB]%'</span>; <span class="comment">-- 不以 A 和 B 开头的任意文本</span></span><br></pre></td></tr></table></figure></li>
<li><p>is null用于判断某些值是否为空，不能使用=。ifnull 判断是否为null<br>如果为null就赋默认值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">ifnull</span>(<span class="keyword">name</span>,<span class="string">'vv'</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>如果where子句后有多个条件需要组合，SQL提供了and和or来组合这两个<br>条件，并提供not来对逻辑表达式求否 <img src="/2020/02/28/Mysql/5.jpg" alt></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">name</span> <span class="keyword">like</span><span class="string">'__'</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'__'</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>执行查询后的结果默认按插入顺序排列，如果需要查询的结果按照某列值<br>的大小排序，则可以使用order by。asc是由低到高，desc是由高到低，支<br>持别名，也支持多个条件排序逗号隔开</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认是asc</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span>;</span><br><span class="line"><span class="comment">#如果需要多列排序，每列都要指定。第一列是首列，当第一列存在相同值第二列才起作用</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="数据库函数"><a href="#数据库函数" class="headerlink" title="数据库函数"></a>数据库函数</h3><p>MySQL函数和编程语言中的函数很像，可以有多个输入但是只有一个输出。<br>函数可以分为单行函数和多行函数，单行函数对每行输入值单独计算，每<br>行得到一个计算结果返回给用户。多行函数对多行输入值整体计算，最后<br>只会得到一个结果 <img src="/2020/02/28/Mysql/6.jpg" alt></p>
<h4 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h4><ul>
<li>参数可以是变量、常量或数据列。可以接收多个参数但只能返回一个</li>
<li>对每行单独起作用</li>
<li>可以改变参数的数据类型，支持嵌套使用，即内层函数的返回值是外层<br>函数的参数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#字符长度</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">char_length</span>(<span class="keyword">name</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">#获取sin值</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sin</span>(<span class="keyword">char_length</span>(<span class="keyword">name</span>)) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>
<p>还提供了四个处理null的函数</p>
<ol>
<li>ifnull(exp1,exp2) 如果exp1为null，返回exp2，否则返回exp1</li>
<li>nullif(exp1,exp2) 如果exp1与exp2相等返回null，否则返回exp1</li>
<li>if(exp1,exp2,exp3) 如果exp1为true，不等于0且不等于null，则<br>返回exp2否则返回exp3<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure></li>
<li>isnull(exp1) 如果exp1为null则返回true，否则返回false</li>
</ol>
<p>MySQL还提供了一个case函数，该函数是一个流程控制函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一种格式</span></span><br><span class="line">case value</span><br><span class="line">when value1 then result1</span><br><span class="line">when value2 then result2</span><br><span class="line">else result</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">#第二种格式</span></span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> condition1 <span class="keyword">then</span> result1</span><br><span class="line"><span class="keyword">when</span> condition2 <span class="keyword">then</span> result2</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>upper变大写，lower变小写<br>substr(str,index)，索引从1开始，substr(str,from,to)，包含to<br>instr(str,strr) 获取起始索引，如果不匹配返回0<br>trim(str) 去掉前后空格<br>lpad(str,number,strr) 左填充字符<br>rpad(str,number,strr) 右填充字符<br>replace(str,str1,str2)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取字节数，一个汉字三个字节</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">length</span>(<span class="string">'jhon'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">length</span>(<span class="string">'张三风'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">upper</span>(<span class="keyword">name</span>) <span class="keyword">from</span> suinfo;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">'你好啊高明'</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">instr</span>(<span class="string">'高明爱上了谁'</span>,<span class="string">'爱'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'   fsd   '</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'a'</span> <span class="keyword">from</span> <span class="string">'aaafsdfdaaa'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">lpad</span>(<span class="string">'高明你好啊小老弟'</span>,<span class="number">15</span>,<span class="string">'*'</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">replace</span>(<span class="string">'周芷若爱上张无忌'</span>,<span class="string">'周芷若'</span>,<span class="string">'赵敏'</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>数学函数<br>round(number) 四舍五入<br>round(number,2) 小数点后保留两位<br>ceil(number) 向上取整<br>floor(number) 向下取整<br>truncate(number,2) 小数点后阶段2位<br>mod(number1,number2) number1%number2</p>
</li>
<li><p>日期函数<br>now() 返回当前日期+时间<br>curdate() 返回当前日期<br>curtime() 返回当前时间<br>year(now()) month(now()) monthname()<br>str_to_date(‘4-3 1999’,’%c-%d %Y’)=’1999-4-3’ 可以解析</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select date_format(now(),'%y年%m月%d日');</span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br><span class="line">| date_format(now(),'%y年%m月%d日') |</span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br><span class="line">| 20年03月05日                      |</span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br></pre></td></tr></table></figure></li>
<li><p>其他函数<br>version() database()</p>
</li>
</ol>
<h3 id="分组和组函数"><a href="#分组和组函数" class="headerlink" title="分组和组函数"></a>分组和组函数</h3><p>组函数就是多行函数，组函数将一组记录作为一个整体计算，每组记录<br>返回一个结果而不是每行记录返回一个结果</p>
<ol>
<li>avg([distinct] exp) 计算多行exp的平均值，exp可以是变量、常量<br>或数据列，但是数据类型必须是数值型，还可以加上distinct表示无重复<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li>count([distinct] exp) 计算多行exp的总条数，count可以是变量、<br>常量或数据列，数据类型可以是任意类型，用*号表示统计所有记录行数，<br>distinct表示不计算重复值，不会计算null<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> <span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li>max(exp) 计算多行中的最大值，exp可以是变量、常量或数据列，数据<br>类型可以是任意类型<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">name</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li>min(exp) 与max相反</li>
<li>sum([distinct] exp) 计算多行exp的总和，exp可以是变量、常量或<br>数据列，但是数据类型必须是数值型<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure></li>
<li>在默认情况下组函数会把所有记录当成一组，为了对记录显示分组可以<br>使用group by子句，group by后通常跟一个或多个列名，表示查询结果<br>根据一列或多列分组，当一列或多列的组合相同会当成一组<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>,<span class="keyword">name</span>;</span><br></pre></td></tr></table></figure></li>
<li>一旦使用组函数或者group by都将导致多条记录只有一条输出，如果<br>需要使用分组过滤则可以使用having子句，having子句后面也是跟一个<br>条件表达式，只有满足该条件表达式的分组才被选择，having和where<br>有如下区别</li>
</ol>
<ul>
<li>不能在where中过滤组，where仅用于过滤行，having用于过滤组</li>
<li>不能在where子句中使用组函数，having可以使用组函数</li>
<li>GROUP BY 子句出现在WHERE子句之后，ORDER BY子句之前，行过滤优<br>先于分组过滤</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="多表连接查询"><a href="#多表连接查询" class="headerlink" title="多表连接查询"></a>多表连接查询</h3><p>很多时候选择的数据不是来自一个表，而是来自多个表，这是就需要多表<br>连接查询，SQL99支持以下几种多表连接查询。多表连接可以理解为一个<br>二重循环，根据条件筛选符合的连接</p>
<ul>
<li>交叉连接</li>
<li>自然连接</li>
<li>使用using子句的连接</li>
<li>使用on子句的连接</li>
<li>全外连接或左、右外连接</li>
</ul>
<ol>
<li>交叉连接 广义笛卡尔积，不需要任何连接条件<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.*,t.nname <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">cross</span> <span class="keyword">join</span> tt t;</span><br></pre></td></tr></table></figure></li>
<li>自然连接 自然连接会以两个表中的同名列作为连接条件，如果没有<br>同名列则与交叉连接效果一样。同名列的意思就是说连接条件是有相同<br>的列名，并且列的值也相同<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.* <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">natural</span> <span class="keyword">join</span> tt t;</span><br></pre></td></tr></table></figure></li>
<li>using子句连接 using子句可以指定一列或多列，用于显示指定两个<br>表中的同列名作为连接条件，假设两个表中有超过一列的同列名，如果<br>使用natural join，则会把所有的同列名当成连接条件，使用using<br>子句就可以显示指定哪些同列名作为连接条件<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.* <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">join</span> tt t <span class="keyword">using</span>(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></li>
<li>on子句连接 这是最常用的连接方式，将连接条件放在on子句中指定，<br>每个on子句只指定一个连接条件，如果要进行N表连接，则需要有N-1个<br>join .. on对<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.* <span class="keyword">from</span> <span class="keyword">test</span> s  <span class="keyword">join</span> tt t <span class="keyword">on</span> s.id=t.id;</span><br></pre></td></tr></table></figure></li>
<li>左、右、全外连接 分别使用left join,right join,full join，这<br>三种外连接的连接条件一样可以使用on子句来指定，MySQL目前不支持全<br>外连接<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#右外连接，右表的记录会全部显示出来，左表只显示满足条件的记录，左边不足的地方用null显示</span></span><br><span class="line"><span class="keyword">select</span> s.*,t.id <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">right</span> <span class="keyword">join</span> tt t <span class="keyword">on</span> s.id&lt;t.id;</span><br><span class="line"><span class="comment">#左外连接</span></span><br><span class="line"><span class="keyword">select</span> s.*,t.id <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">left</span> <span class="keyword">join</span> tt t <span class="keyword">on</span> s.id&lt;t.id;</span><br></pre></td></tr></table></figure></li>
<li>内连接 也就是符合条件就显示<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.*,t.id <span class="keyword">from</span> <span class="keyword">test</span> s <span class="keyword">inner</span> <span class="keyword">join</span> tt t <span class="keyword">on</span> s.id&lt;t.id;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询就是在查询语句中嵌套另一个查询，子查询可以支持多层嵌套，对于<br>一个普通的查询语句而言，子查询可以出现在两个位置</p>
<ul>
<li>出现在from语句后当成数据表，这种用法也被称为行内视图，因为该子<br>查询的实质就是一个临时视图</li>
<li>出现在where条件后作为过滤条件的值</li>
</ul>
<p>使用子查询时要注意如下几点</p>
<ul>
<li>子查询要用括号括起来</li>
<li>当把子查询当成数据表时（出现在from之后）,可以为该子查询起别名，尤<br>其作为前缀来限定数据列时，必须给子查询起别名</li>
<li>把子查询当成过滤条件时，将子查询放在比较运算符的右边，这样可以<br>增强查询的可读性</li>
<li>把子查询当成过滤条件时，单行子查询使用单行运算符，多行子查询使用<br>多行运算符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将子查询当成数据表</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>) t <span class="keyword">where</span> t.id&gt;<span class="number">1</span>;</span><br><span class="line"><span class="comment">#将子查询当成标量值使用，也就是返回一个单行单列值</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>  <span class="keyword">where</span> <span class="keyword">id</span> &gt; (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> tt <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'fds'</span>);</span><br><span class="line"><span class="comment">#子查询返回多个值，则需要使用in all any</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>  <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> tt);</span><br><span class="line"><span class="comment">#等价于</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>  <span class="keyword">where</span> <span class="keyword">id</span> = <span class="keyword">any</span>(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> tt);</span><br><span class="line"><span class="comment">#子查询还可以返回多行多列</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>  <span class="keyword">where</span> (<span class="keyword">id</span>,<span class="keyword">name</span>) = <span class="keyword">any</span>(<span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> tt);</span><br></pre></td></tr></table></figure>

<p>判断子查询的结果是否存在，若存在返回1不存在返回0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> exist(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> employee);</span><br></pre></td></tr></table></figure>

<h3 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h3><p>select语句的查询结果是一个包含多条数据的结果集，类似于数学中的集合，可以进<br>行交、并和差运算。对于两个结果集进行集合运算必须满足如下条件</p>
<ul>
<li>两个结果集所包含的数据列的数量必须相等</li>
<li>两个数据列所包含的数据类型必须一一对应</li>
</ul>
<ol>
<li>union运算 取并集<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test  union select id,name from tt;</span><br></pre></td></tr></table></figure></li>
<li>minus运算 MySQL并不支持差运算，不过可以借助子查询实现差运算<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#从test中减去与tt中相同的记录</span><br><span class="line">select * from test  minus select id,name from tt;</span><br><span class="line">#使用子查询实现</span><br><span class="line">select * from test  where (id,name) not in (select id,name from tt);</span><br></pre></td></tr></table></figure></li>
<li>intersect运算 MySQL并不支持交运算，可以借助多表连接查询实现<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#两个数据列的数量想等，数据类型一一对应</span><br><span class="line">select * from test  intersect select id,name from tt;</span><br><span class="line">select * from test t  join tt s on (t.id&#x3D;s.id and t.name&#x3D;s.name);</span><br></pre></td></tr></table></figure>
注意如果intersect运算的两个select子句都包含where条件，那么将intersect<br>运算改写成多表连接查询后还需要将两个where条件进行and运算<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id&lt;4 intersect select id,name from tt where name </span><br><span class="line">like &#39;%fd&#39;;</span><br><span class="line">select * from test t join tt s on(t.id&#x3D;s.id and t.name &#x3D;s.name) where </span><br><span class="line">(t.id&lt;4 and s.name like &#39;%fd&#39;);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h2><p>与DDL操纵数据表不同，DML主要操作数据表里的数据，包含插入删除和修改</p>
<ol>
<li>插入数据，一次只能插入一条数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#表名后是所以列名，列名后是相应的值</span><br><span class="line">insert into test(id,name) values(1,&#39;xyz&#39;);</span><br><span class="line">#部分列名，其余列名为null，注意id是primary，所以不能替换为name</span><br><span class="line">insert into test(id) values(2);</span><br><span class="line">#也可以省略列名</span><br><span class="line">insert into test values(3,&#39;lkj&#39;);</span><br><span class="line">#扩展语法，可以同时插入多个值</span><br><span class="line">insert into test values(5,&#39;lkj&#39;),(6,&#39;va&#39;);</span><br><span class="line">#根据外键约束规则，外键列的值必须是主表中的值，不过可以为null</span><br><span class="line">insert into fortest values(3&#x2F;5&#x2F;6);</span><br><span class="line">#可是使用带子查询的插入语句，一次插入多条记录</span><br><span class="line">insert into test(id) select iid from tabb;</span><br></pre></td></tr></table></figure></li>
<li>修改语句<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#where是修改的条件，也可以一次修改多列</span><br><span class="line">update suinfo set name&#x3D;&#39;mn&#39; where id&#x3D;7;</span><br></pre></td></tr></table></figure></li>
<li>删除语句<br>delete可以加where，truncate 不能加where，可以实现一次删除多行当<br>主表被从表参照时，主表记录不能被删除，只有先将从表参照的所有主表<br>的数据删除后才可以删除主表的数据。还有一种情况就是定义外键约束时<br>定义了主表记录和从表记录的级联删除on delete cascade或者使用on<br>delete set null指定当主表记录删除时从表参照的主表记录列设置为null<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from suinfo where id&#x3D;5;</span><br><span class="line">truncate table suinfo;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><p>操作数据库对象，包括创建删除和修改 <img src="/2020/02/28/Mysql/1.jpg" alt></p>
<ol>
<li>创建库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database book default character set utf8mb4;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br></pre></td></tr></table></figure></li>
<li>删除库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database book;</span><br><span class="line">Query OK, 0 rows affected (0.10 sec)</span><br></pre></td></tr></table></figure></li>
<li>创建表 <img src="/2020/02/28/Mysql/2.jpg" alt> <img src="/2020/02/28/Mysql/3.jpg" alt><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">	#列名 列的类型</span><br><span class="line">	id int,price decimal,name varchar(20),desc text,img blog</span><br><span class="line">	);</span><br></pre></td></tr></table></figure></li>
<li>表的修改<br>可以修改列名和类型，一次只能修改一个列定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#修改列名</span><br><span class="line">mysql&gt; alter table suu change  nuid nnid int;</span><br><span class="line">#修改列类型</span><br><span class="line">mysql&gt; alter table suu modify  nnid varchar(20);</span><br></pre></td></tr></table></figure></li>
<li>添加新列，需要注意如果数据表中已经有数据，除非给新列指定默认值，<br>否则新增的数据列不可指定非空约束，因为已有的数据在新列上一定是空的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu add </span><br><span class="line">(id int,name varchar(20) default &#39;xxx&#39;);</span><br></pre></td></tr></table></figure></li>
<li>删除新列<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu drop id;</span><br></pre></td></tr></table></figure></li>
<li>修改表名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu rename to su;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure></li>
<li>表的删除<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#表的结构也被删除</span></span><br><span class="line">mysql&gt; drop table su;</span><br><span class="line"><span class="comment">#只删除数据，不删除表的结构，只能一次性删除所有数据</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> su;</span><br><span class="line"><span class="comment">#也是删除所有数据，注意如果主键是自增的那么会从之前最大的主键值下一个开始自增</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> te;</span><br></pre></td></tr></table></figure></li>
<li>表的复制<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#仅仅复制表的结构</span><br><span class="line">mysql&gt; create table copy like suinfo;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">#复制表的结构和数据，也可以复制部分数据</span><br><span class="line">mysql&gt; create table copy select * from suinfo;</span><br><span class="line">Query OK, 6 rows affected (0.04 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h3><p>所有的关系数据库都支持对数据表使用约束，约束是在表上强制执行的数据<br>校验规则，主要用于保证数据的完整性，除此以外当表中的数据存在相互依<br>赖时可以保护相关的数据不被删除。可以分为单列约束和多列约束，指定约<br>束有两个时机，可以在创建表的同时为相应的数据列指定约束，或创建表后<br>以修改表的方式来增加约束</p>
<ul>
<li>not null 非空约束，该字段不能为空   </li>
<li>primary key 主键保证唯一性并且非空  </li>
<li>unique 字段值具有唯一性但是可以为空   </li>
<li>foreign key 外键用于限制两个表的关系保证该字段的值来自主表的关<br>联列的值，在从表中添加外键约束用于引用主表某列的值</li>
</ul>
<ol>
<li>非空约束 所有数据类型的值都可以是null，只能作为列级约束使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table hehe</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    name varchar(20) default &#39;xyz&#39; not null,</span><br><span class="line">    #默认就是空</span><br><span class="line">    gender varchar(2) null</span><br><span class="line">);</span><br><span class="line">#也可以修改表</span><br><span class="line">alter table hehe</span><br><span class="line">modify gender varchar(2) not null;</span><br><span class="line">alter table hehe</span><br><span class="line">modify id int(11) null;</span><br><span class="line">alter table hehe</span><br><span class="line">modify name varchar(3) default &#39;abc&#39; null;</span><br></pre></td></tr></table></figure></li>
<li>unique约束 唯一约束用于保证指定列或指定列组合不允许出现重复值，<br>但是可以出现null，在数据库中null不等于null。同一个表中可以建立多<br>个唯一约束，唯一约束也可以由多个列组成，如果不给唯一约束起名则默<br>认与列名相同，如果需要为多列组合约束或者为唯一约束指定约束名则只<br>能使用表级约束<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    #列级约束</span><br><span class="line">    name varchar(20) unique</span><br><span class="line">);</span><br><span class="line">create table test2</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    #表级约束</span><br><span class="line">    unique(name),</span><br><span class="line">    #表级约束并制定约束名</span><br><span class="line">    constraint uk unique(pass)</span><br><span class="line">);</span><br><span class="line">create table test3</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    #两列组合建立唯一约束，一般是要取表名，要不然删除没有名字无法将组合约束删除</span><br><span class="line">    constraint uuk unique(name,pass)</span><br><span class="line">);</span><br><span class="line">create table test4</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20)</span><br><span class="line">);</span><br><span class="line">#表级约束语法也可以放在alter语句中，为两列组合建立唯一约束</span><br><span class="line">alter table test4</span><br><span class="line">add unique(name,pass);</span><br><span class="line">#使用列级约束语法</span><br><span class="line">alter table test4</span><br><span class="line">modify pass varchar(30) unique;</span><br><span class="line"># drop index 约束名</span><br><span class="line">alter table test3</span><br><span class="line">drop index uuk;</span><br></pre></td></tr></table></figure></li>
<li>primary key 主键约束相当于非空约束和唯一约束，不能出现重复<br>值也不能出现null值，如果对多列组合建立唯一约束，则多列组合里每<br>一列都不能为空，每一个表中最多允许有一个主键，但是可以由多个列<br>组成，不管是否指定约束名，Mysql总是将所有主键约束命名为primary<br>很多数据库对主键列都支持自增长特性，如果某个数据列是整型并且是<br>主键列那么可以指定该列具有自增长功能，而且插入时不可以为该列指<br>定值，可以用null替代，数据由数据库自动生成<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	#主键约束，采用列级约束语法</span><br><span class="line">	id int primary key,</span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br><span class="line">create table test2</span><br><span class="line">(</span><br><span class="line">	id int,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    #表级约束，不需要指定约束名</span><br><span class="line">    constraint primary key(id)</span><br><span class="line">);</span><br><span class="line">create table test3</span><br><span class="line">(</span><br><span class="line">	id int,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    #表级约束，不需要指定约束名</span><br><span class="line">    constraint primary key(id,name)</span><br><span class="line">);</span><br><span class="line">#删除主键约束</span><br><span class="line">alter table test3</span><br><span class="line">drop primary key;</span><br><span class="line">#表级约束语法</span><br><span class="line">alter table test3</span><br><span class="line">add primary key(id,name);</span><br><span class="line">#如果只是单独列增加主键约束可以使用modify</span><br><span class="line">alter table test3</span><br><span class="line">modify name varchar(200) primary key;</span><br></pre></td></tr></table></figure></li>
<li>foregin key 外键约束用于保证一个或两个表之间的参照完整性，外键<br>是构建于一个表的两个字段或者两个表的两个字段之间的参照关系。子表外<br>键列的值必须在主表被参照列的范围之内，或者为空。子表参照的只能是主<br>表主键列或者是唯一键列，同一个表内可以拥有多个外键。外键约束通常用<br>于学生与老师之间的对应关系，外键约束不仅可以参照其他表也可以参照<br>自身，被称为自关联，比如一个部门的经理与员工。如果想定义删除主表<br>记录时将从表的记录也删除，则需要在外键约束的最后添加on delete<br>cascade或on delete set null，第一种是删除主表记录时将从表记<br>录全部级联删除，第二种是将外键设置为null<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">create table teacher</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br><span class="line">#Mysql并不支持这种列级语法</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int references teacher(id)</span><br><span class="line">);</span><br><span class="line">#Mysql支持表级约束</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int,</span><br><span class="line">    foreign key(teacherid) references teacher(id)</span><br><span class="line">);</span><br><span class="line">#constraint可以显示指定从表的名字</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int,</span><br><span class="line">    constraint stuteach foreign key(teacherid) references</span><br><span class="line">    teacher(id)</span><br><span class="line">);</span><br><span class="line">#多列组合的外键约束必须使用表级语法</span><br><span class="line">create table teacher</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    primary key(name,pass)</span><br><span class="line">);</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    foreign key(name,pass) references</span><br><span class="line">    teacher(name,pass)</span><br><span class="line">);</span><br><span class="line">#删除外键约束，默认外键约束名是table_name_ibfk_n</span><br><span class="line">alter table student</span><br><span class="line">drop foreign key student_ibfk_1;</span><br><span class="line">#增加外键约束</span><br><span class="line">alter table student</span><br><span class="line">add foreign key(name,pass) references </span><br><span class="line">teacher(name,pass);</span><br><span class="line">#自关联</span><br><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    namr varchar(20),</span><br><span class="line">    foreign key(id) references test(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>参考 <a href="https://www.cnblogs.com/whgk/p/6179612.html" target="_blank" rel="noopener">https://www.cnblogs.com/whgk/p/6179612.html</a><br>索引用于快速找出某个列中有一特定值的行，如果不使用索引那么会从表的<br>第一行开始查找，如果表中查询的列有一个索引，那么就能快速到达指定位<br>置而不需要遍历整个数据表，Mysql索引的底层结构使用B+树和hash</p>
<h4 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h4><ul>
<li>优点 数据库表中的所有列都可以设置索引，加快查询速度</li>
<li>缺点 创建索引和维护索引需要消耗一定时间，随数据量增加耗时也会增加，<br>索引也需要占据空间，数据表中的数据有最大上限设置，如果有大量索引那么<br>索引文件可能比数据更先到达上限。当对表中的数据进行增加、删除修改时，<br>索引也需要动态维护</li>
</ul>
<p>基于以上优点和缺点，对于经常更新的表应该较少使用索引，对经常用于查询<br>的字段创建索引，数据量小的表最好不要创建索引，有可能索引的效率还不如<br>直接遍历查询，对于值较少的字段不要创建索引，比如性别只有两种可能就不<br>需要，对值较多的字段可以创建索引</p>
<h4 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h4><p>索引是在存储引擎中实现的，不同的存储引擎会用到不同的索引</p>
<ul>
<li>MyISAM和InnoDB存储引擎：支持HASH和BTREE索引</li>
<li>MEMORY/HEAP存储引擎：支持HASH和BTREE索引</li>
</ul>
<p>索引可以分为4类</p>
<ol>
<li>单列索引 一个索引只包含一个列，但是一个表中可以有多个索引</li>
</ol>
<ul>
<li>普通索引 没有什么限制，允许在定义索引的列中插入重复值和空值</li>
<li>唯一索引 索引列中的值是唯一的，但是允许为空</li>
<li>主键索引 特殊的唯一索引，不允许有空值</li>
</ul>
<ol start="2">
<li>组合索引 在表中多个字段组合上创建索引，只有在查询时使用这些字段的<br>左边字段索引才会被使用</li>
<li>全文索引 只有在MyISAM引擎上才能使用，只能在CHAR,VARCHAR,TEXT类型<br>字段上使用全文索引</li>
<li>空间索引 对空间数据类型的字段建立索引，MySQL中的空间数据类型有四种<br>，GEOMETRY、POINT、LINESTRING、POLYGON</li>
</ol>
<h4 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h4><p>创建表的同时可以创建索引，通常有两种方式。除此以外当在表上定义主键约束、<br>唯一约束和外键约束时，系统会自动为数据列创建对应的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">	name varchar(255) not null,</span><br><span class="line">	comment varchar(255),</span><br><span class="line">	year_publication year not null,</span><br><span class="line">	index(year_publication)</span><br><span class="line">	#也可以为索引指定一个名字，key也一样</span><br><span class="line">	#index yearp (year_publication)</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">	name varchar(255) not null,</span><br><span class="line">	comment varchar(255),</span><br><span class="line">	year_publication year not null,</span><br><span class="line">	key(year_publication)</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
<p>explain可以用来查看索引是否正在被使用，并输出所用的索引信息 <img src="/2020/02/28/Mysql/16.jpg" alt></p>
<ul>
<li>possible_keys Mysql在搜索数据记录时可以选用的各个索引</li>
<li>key 实际选用的索引</li>
</ul>
<p>创建唯一索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">	name varchar(255) not null,</span><br><span class="line">	#索引名为uniqidx</span><br><span class="line">	unique index uniqidx(id)</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
<p>注意要查看查询时使用的索引必须先向表中插入数据，如果查询一个不存在的<br>id值是不会使用索引的，内部应该是将所有已有的id保存起来，如果没有该<br>id值就不会查找 <img src="/2020/02/28/Mysql/17.jpg" alt><br>接下来创建组合索引，也就是在多个字段创建索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">    age int not null,</span><br><span class="line">	name varchar(255) not null,</span><br><span class="line">    index multip(id,age,name)</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>
<p>组合索引遵循最左前缀，利用索引中最左边的列集来匹配行，这样的列级称为<br>最左前缀。例如这里使用id age name三个字段组合构成索引，索引行中就会<br>按照id age name来存放，可以通过(id,age,name) (id,age) (id)来查<br>询字段，如果不是以上三种就不会使用索引查询。这个部分有点问题，先鸽<br>着 <img src="/2020/02/28/Mysql/18.jpg" alt><br>接下来创建全文索引，但只有MyISAM存储引擎支持FULLTEXT索引，并且只为<br>CHAR、VARCHAR和TEXT列服务。索引总是对整个列进行，不支持前缀索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">    age int not null,</span><br><span class="line">	name varchar(255) not null,</span><br><span class="line">    fulltext index FullTxt(name)</span><br><span class="line">	)ENGINE&#x3D;MyISAM;</span><br></pre></td></tr></table></figure>
<p>全文搜索一般是从很长的字符串中通过关键字查找数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#关键字至少4个字符</span><br><span class="line">select * from book where match(name) against(&#39;xxxx&#39;);</span><br></pre></td></tr></table></figure>
<p>接下来创建空间索引，空间索引也必须使用MyISAM引擎， 并且空间类型的字<br>段必须为非空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">	id int not null,</span><br><span class="line">    g GEOMETRY NOT NULL,</span><br><span class="line">    SPATIAL INDEX spatIdx(g)</span><br><span class="line">	)ENGINE&#x3D;MyISAM;</span><br></pre></td></tr></table></figure>
<p>还可以在已经存在的表上建立索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ADD[UNIQUE|FULLTEXT|SPATIAL][INDEX|KEY] [索引名] </span><br><span class="line">	(索引字段名)[ASC|DESC]</span><br><span class="line">CREATE [UNIQUE|FULLTEXT|SPATIAL] [INDEX|KEY] 索引名称 ON 表名(</span><br><span class="line">	创建索引的字段名[length])[ASC|DESC]</span><br><span class="line">show index from tablename</span><br></pre></td></tr></table></figure>
<p>删除索引如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 DROP INDEX 索引名</span><br><span class="line">DROP INDEX 索引名 ON 表名</span><br></pre></td></tr></table></figure>

<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图像一个数据表但不是数据表，因为视图并不能存储数据，只是一个或多个<br>数据表中数据的逻辑显示。视图的本质就是一条被命名为sql的查询语句，有<br>以下好处。注意修改视图的数据时也会修改到基本数据表</p>
<ul>
<li>可以限制对数据的访问</li>
<li>可以使复杂的查询变得简单</li>
<li>提供了数据的独立性</li>
<li>提供对先沟通数据的不同显示</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">view</span> viewname <span class="keyword">as</span> subquery</span><br><span class="line"><span class="comment">#创建视图并且不允许修改数据，通常不允许修改视图数据</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> viewtest <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">with</span> <span class="keyword">check</span> <span class="keyword">option</span>;</span><br><span class="line"><span class="comment">#删除视图</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> viewtest;</span><br></pre></td></tr></table></figure>
<p>指定了witch check option关键字，这也就是说，更新后的每一条数据仍然<br>要满足创建视图时指定的where条件，插入和更新操作会失败，删除不会受影<br>响，具备以下特点的视图不可以修改</p>
<ul>
<li>distinct group by having union union all</li>
<li>select 包含子查询</li>
</ul>
<h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>搜索表结构中部分数据，limit position,count 。position表示起始查询<br>的位置，起始索引是0，count表示查询的数量。也可以直接 limit count</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查询第二高的薪水</span><br><span class="line">select salary from table order by salary desc limit 1,1;</span><br></pre></td></tr></table></figure>

<h2 id="事务TCL"><a href="#事务TCL" class="headerlink" title="事务TCL"></a>事务TCL</h2><h3 id="事务的创建"><a href="#事务的创建" class="headerlink" title="事务的创建"></a>事务的创建</h3><p>隐式事务没有明显开启和结束的标记</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set autocommit=0;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>编写事务(select insert update delete)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">'avaa'</span>,<span class="string">'vvvv'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">'rq'</span>,<span class="string">'ooo'</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher <span class="keyword">values</span>(<span class="string">'avaa'</span>,<span class="string">'vvvv'</span>);</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### 回滚</span></span><br><span class="line">指撤销指定 SQL 语句的过程,不能回退 <span class="keyword">SELECT</span> 语句，回退 <span class="keyword">SELECT</span> 语句</span><br><span class="line">也没意义，也不能回退 <span class="keyword">CREATE</span> 和 <span class="keyword">DROP</span> 语句</span><br><span class="line"><span class="string">``</span><span class="string">` sql</span></span><br><span class="line"><span class="string">savepoint a; #设置保存点</span></span><br><span class="line"><span class="string">....</span></span><br><span class="line"><span class="string"># 保存点指事务处理中设置的临时占位符（placeholder），你可以对它发布回退</span></span><br><span class="line"><span class="string">rollback to a; #回滚到a</span></span><br></pre></td></tr></table></figure>

<h3 id="delete和truncate在事务中的区别"><a href="#delete和truncate在事务中的区别" class="headerlink" title="delete和truncate在事务中的区别"></a>delete和truncate在事务中的区别</h3><p>声明事务后</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> pperson;</span><br><span class="line"><span class="keyword">rollback</span>; <span class="comment">#依然有数据</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> pperson;</span><br><span class="line"><span class="keyword">rollback</span>; <span class="comment">#数据消失，不支持回滚</span></span><br></pre></td></tr></table></figure>
<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>一组预先编译好的sql语句的集合，理解成批处理语句，可以提高代码重用性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">delimiter 结束标记 $</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名(参数列表) <span class="comment">#参数模式 参数名 参数类型</span></span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	方法体</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"><span class="keyword">call</span> 存储过程名(实参列表) $</span><br><span class="line">delimiter //</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> myprocedure( <span class="keyword">out</span> ret <span class="built_in">int</span> )</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">declare</span> y <span class="built_in">int</span>;</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">sum</span>(col1) <span class="keyword">from</span> mytable <span class="keyword">into</span> y;</span><br><span class="line">        <span class="keyword">select</span> y*y <span class="keyword">into</span> ret;</span><br><span class="line">    <span class="keyword">end</span> //</span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> myprocedure(@ret);</span><br><span class="line"><span class="keyword">select</span> @ret;</span><br></pre></td></tr></table></figure>
<h3 id="参数模式"><a href="#参数模式" class="headerlink" title="参数模式"></a>参数模式</h3><ul>
<li>in 可以作为输入，也就是需要调用时存入值</li>
<li>out 可以作为输出。作为返回值</li>
<li>inout 既可以作为输入也可以作为输出</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> mm(<span class="keyword">in</span> beauty <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="keyword">in</span> <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> <span class="keyword">result</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">into</span> <span class="keyword">result</span></span><br><span class="line">	<span class="keyword">from</span> person</span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">select</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"><span class="keyword">call</span> mm(<span class="string">'df'</span>,<span class="number">234</span>)$</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> my(<span class="keyword">in</span> beautyname <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="keyword">out</span> boyname <span class="built_in">varchar</span>(<span class="number">20</span>),..)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> bo.name... <span class="keyword">into</span> boyname,..</span><br><span class="line">	<span class="keyword">from</span> boys bo</span><br><span class="line">	<span class="keyword">inner</span> <span class="keyword">join</span> beauty b <span class="keyword">on</span> bo.id=b.boyid</span><br><span class="line">	<span class="keyword">where</span> b.name=beautyname;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"><span class="keyword">set</span> @boy$</span><br><span class="line"><span class="keyword">call</span> my(<span class="string">'fds'</span>,@boy)$</span><br><span class="line"><span class="keyword">select</span> @boy$</span><br></pre></td></tr></table></figure>
<p>删除存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> my</span><br></pre></td></tr></table></figure>
<p>查看存储过程的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> my;</span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>存储过程可以有多个返回值，函数只有一个返回值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> 函数名(参数列表) <span class="keyword">returns</span> 返回类型</span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line">	<span class="keyword">declare</span> c <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">set</span> c=<span class="number">1</span>;</span><br><span class="line">	函数体</span><br><span class="line">	return c;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">select</span> 函数名(参数列表)</span><br></pre></td></tr></table></figure>
<p>查看函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">function</span> mm;</span><br></pre></td></tr></table></figure>
<p>删除函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> mm;</span><br></pre></td></tr></table></figure>
<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>在存储过程中使用游标可以对一个结果集进行移动遍历。游标主要用于交互<br>式应用，其中用户需要对数据集中的任意行进行浏览和修改。使用游标的四<br>个步骤：</p>
<ol>
<li>声明游标，这个过程没有实际检索出数据</li>
<li>打开游标</li>
<li>取出数据</li>
<li>关闭游标</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> myprocedure(<span class="keyword">out</span> ret <span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">declare</span> done <span class="built_in">boolean</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">declare</span> mycursor <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">        <span class="keyword">select</span> col1 <span class="keyword">from</span> mytable;</span><br><span class="line">        <span class="comment">/* 定义了一个 continue handler，当 sqlstate '02000' 这个条件出现时，</span></span><br><span class="line"><span class="comment">         会执行 set done = 1*/</span></span><br><span class="line">        <span class="keyword">declare</span> continue <span class="keyword">handler</span> <span class="keyword">for</span> <span class="keyword">sqlstate</span> <span class="string">'02000'</span> <span class="keyword">set</span> done = <span class="number">1</span>;</span><br><span class="line">        open mycursor;</span><br><span class="line">        repeat</span><br><span class="line">            fetch mycursor into ret;</span><br><span class="line">            <span class="keyword">select</span> ret;</span><br><span class="line">        until done <span class="keyword">end</span> <span class="keyword">repeat</span>;</span><br><span class="line">        close mycursor;</span><br><span class="line">    <span class="keyword">end</span> //</span><br><span class="line"> delimiter ;</span><br></pre></td></tr></table></figure>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p>触发器会在某个表执行以下语句时而自动执行：DELETE、INSERT、UPDATE。<br>触发器必须指定在语句执行之前还是之后自动执行，之前执行使用 BEFORE<br>关键字，之后执行使用 AFTER 关键字。BEFORE 用于数据验证和净化，<br>AFTER 用于审计跟踪，将修改记录到另外一张表中<br>INSERT 触发器包含一个名为 NEW 的虚拟表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> mytrigger <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> mytable</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">SELECT</span> NEW.col <span class="keyword">into</span> @<span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">result</span>; <span class="comment">-- 获取结果</span></span><br></pre></td></tr></table></figure>
<p>DELETE 触发器包含一个名为 OLD 的虚拟表，并且是只读的<br>UPDATE 触发器包含一个名为 NEW 和一个名为 OLD 的虚拟表，其中 NEW 是<br>可以被修改的，而 OLD 是只读的<br>MySQL 不允许在触发器中使用 CALL 语句，也就是不能调用存储过程</p>
<h2 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h2><p>参考：猴子数据分析–通俗易懂的学会：SQL窗口函数</p>
<h3 id="窗口函数的作用"><a href="#窗口函数的作用" class="headerlink" title="窗口函数的作用"></a>窗口函数的作用</h3><p>窗口函数用于处理排名问题</p>
<ul>
<li>每个部门按照业绩排名</li>
<li>找出每个部分排名前N个人</li>
</ul>
<h3 id="窗口函数的使用"><a href="#窗口函数的使用" class="headerlink" title="窗口函数的使用"></a>窗口函数的使用</h3><p>窗口函数，也叫OLAP函数（Online Anallytical Processing，联机分析处理）<br>，可以对数据库数据进行实时分析处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;窗口函数&gt; over (partition by &lt;用于分组的列名&gt;</span><br><span class="line">                order by &lt;用于排序的列名&gt;)</span><br></pre></td></tr></table></figure>
<p>窗口函数可以分为两种：专用窗口函数和聚合函数</p>
<ul>
<li>专用窗口函数 rank, dense_rank, row_number</li>
<li>聚合函数 sum. avg, count, max, min</li>
</ul>
<p>因为窗口函数是对where和group by子句处理后的结果进行操作，所以窗口函数<br>原则上只能在select子句中使用</p>
<h4 id="rank"><a href="#rank" class="headerlink" title="rank"></a>rank</h4><p>如果想要在每个班级按照成绩排名 <img src="/2020/02/28/Mysql/7.jpg" alt> <img src="/2020/02/28/Mysql/8.jpg" alt><br>套模型的话写法如下，首先按照班级进行分组，然后在班级内对成绩进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select *,</span><br><span class="line">   rank() over (partition by 班级</span><br><span class="line">                 order by 成绩 desc) as ranking</span><br><span class="line">from 班级表</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/28/Mysql/9.jpg" alt><br>group by会改变表的行数，一行只有一个类别，而partiition by和rank<br>函数不会减少原表中的行数 <img src="/2020/02/28/Mysql/10.jpg" alt></p>
<h4 id="其他专业窗口函数"><a href="#其他专业窗口函数" class="headerlink" title="其他专业窗口函数"></a>其他专业窗口函数</h4><p>除了rank外还有dense_rank, row_number</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select *,</span><br><span class="line">   rank() over (order by 成绩 desc) as ranking,</span><br><span class="line">   dense_rank() over (order by 成绩 desc) as dese_rank,</span><br><span class="line">   row_number() over (order by 成绩 desc) as row_num</span><br><span class="line">from 班级表</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/28/Mysql/11.jpg" alt><br>可以看出rank如果有并列名次的行会占据下一个名次的位置，dense_rank<br>如果有并列名次的行不会占用下一行的位置，row_number不会考虑并列名<br>次的情况</p>
<h4 id="聚合函数作为窗口函数"><a href="#聚合函数作为窗口函数" class="headerlink" title="聚合函数作为窗口函数"></a>聚合函数作为窗口函数</h4><p>只需要用聚合函数替代窗口函数的位置，但是括号中需要指定聚合的列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select *,</span><br><span class="line">   sum(成绩) over (order by 学号) as current_sum,</span><br><span class="line">   avg(成绩) over (order by 学号) as current_avg,</span><br><span class="line">   count(成绩) over (order by 学号) as current_count,</span><br><span class="line">   max(成绩) over (order by 学号) as current_max,</span><br><span class="line">   min(成绩) over (order by 学号) as current_min</span><br><span class="line">from 班级表</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/28/Mysql/12.jpg" alt><br>单独使用sum可以发现是对自身记录及以上的数据进行求和，求平均、计数、最大<br>和最小值也是如此 <img src="/2020/02/28/Mysql/13.jpg" alt></p>
<h2 id="Mysql三范式"><a href="#Mysql三范式" class="headerlink" title="Mysql三范式"></a>Mysql三范式</h2><h3 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h3><p>保证每列的原子性，数据库中所有表的字段值都是不可分解的原子值。第一范式是<br>对关系模型的基本要求，不满足第一范式就不是关系数据库</p>
<h3 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h3><p>保证一张表只描述一件事，要求每个行必须可以被唯一区分，非主键与主键有关<br>联，以下表中学分依赖于课程，年龄和成绩依赖学生，这种表有很多缺点</p>
<ol>
<li>数据冗余 一个课程多个学生修，学分重复。一个学生修多门课，导致年龄和<br>姓名重复</li>
<li>更新异常 如果调整某门课的学分，将导致表中所有这门课的学分都要更新</li>
<li>插入异常 如果开设一门新的课，当暂时还没有人修，无法插入完整数据</li>
<li>删除异常 如果学生修完一些课，那么这些课就应该删除，但是学分和成绩<br>也会相应删除 <img src="/2020/02/28/Mysql/14.jpg" alt></li>
</ol>
<h3 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h3><p>保证每列和主键都直接相关，也就是说决定某些字段值的必须是主键 <img src="/2020/02/28/Mysql/15.jpg" alt><br>第二范式与第三范式的区别在于第三范式消除了传递依赖，比如A–B–C，虽然<br>A和C是有关系的，但是这种关系是通过B来建立的，并不是直接依赖A</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">高明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://skysea-gaoming.github.io/2020/02/28/Mysql/">https://skysea-gaoming.github.io/2020/02/28/Mysql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DataBase/">DataBase</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/28/Mybatis/"><i class="fa fa-chevron-left">  </i><span>Mybatis</span></a></div><div class="next-post pull-right"><a href="/2020/02/28/Maven/"><span>Maven</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://skysea-gaoming.github.io/2020/02/28/Mysql/';
  this.page.identifier = '2020/02/28/Mysql/';
  this.page.title = 'MySQL';
}
var d = document, s = d.createElement('script');
s.src = "https://" + '你的disqus的 short-name' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://你的disqus的 short-name.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By 高明</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>