<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Mysql"><meta name="keywords" content="DataBase"><meta name="author" content="高明"><meta name="copyright" content="高明"><title>Mysql | SkySea-GaoMing</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql概述"><span class="toc-number">2.</span> <span class="toc-text">Mysql概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库基本概念"><span class="toc-number">2.1.</span> <span class="toc-text">数据库基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关系模型"><span class="toc-number">2.2.</span> <span class="toc-text">关系模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL"><span class="toc-number">2.3.</span> <span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL使用"><span class="toc-number">2.4.</span> <span class="toc-text">MySQL使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL基本命令"><span class="toc-number">2.5.</span> <span class="toc-text">MySQL基本命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DQL"><span class="toc-number">3.</span> <span class="toc-text">DQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DML"><span class="toc-number">4.</span> <span class="toc-text">DML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDL"><span class="toc-number">5.</span> <span class="toc-text">DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常见约束"><span class="toc-number">5.1.</span> <span class="toc-text">常见约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引"><span class="toc-number">5.2.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图"><span class="toc-number">5.3.</span> <span class="toc-text">视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务TCL"><span class="toc-number">6.</span> <span class="toc-text">事务TCL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#事务的属性"><span class="toc-number">6.1.</span> <span class="toc-text">事务的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务的创建"><span class="toc-number">6.2.</span> <span class="toc-text">事务的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务的并发问题"><span class="toc-number">6.3.</span> <span class="toc-text">事务的并发问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务的隔离级别"><span class="toc-number">6.4.</span> <span class="toc-text">事务的隔离级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#回滚"><span class="toc-number">6.5.</span> <span class="toc-text">回滚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图-1"><span class="toc-number">7.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#视图的更新"><span class="toc-number">7.1.</span> <span class="toc-text">视图的更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图和表"><span class="toc-number">7.2.</span> <span class="toc-text">视图和表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete和truncate在事务中的区别"><span class="toc-number">7.3.</span> <span class="toc-text">delete和truncate在事务中的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储过程和函数"><span class="toc-number">8.</span> <span class="toc-text">存储过程和函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">8.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储过程"><span class="toc-number">8.2.</span> <span class="toc-text">存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参数模式"><span class="toc-number">8.3.</span> <span class="toc-text">参数模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数"><span class="toc-number">8.4.</span> <span class="toc-text">函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#流程控制结构"><span class="toc-number">9.</span> <span class="toc-text">流程控制结构</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1582898893694&amp;di=15958b0625c3bcbdd505353b8b5deaa4&amp;imgtype=0&amp;src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F068c0cbf1b1571976ada2e55a53b3a079e1614c5.jpg"></div><div class="author-info__name text-center">高明</div><div class="author-info__description text-center">JAVA</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">32</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">11</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1599140437492&amp;di=195fa5a4bc93905108d4f72b9167b0c0&amp;imgtype=0&amp;src=http%3A%2F%2Fphoto.tuchong.com%2F443730%2Ff%2F14505255.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SkySea-GaoMing</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Mysql</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/">后端技术</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2020/02/28/Mysql/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2020/02/28/Mysql/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>参考《数据库系统概论》 尚硅谷Mysql教程</p>
<h2 id="Mysql概述"><a href="#Mysql概述" class="headerlink" title="Mysql概述"></a>Mysql概述</h2><p>MySQL是最流行的关系型数据库管理系统，数据库（Database）是按照数据结<br>构来组织、存储和管理数据的仓库，所谓的关系型数据库，是建立在关系模型<br>基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据</p>
<h3 id="数据库基本概念"><a href="#数据库基本概念" class="headerlink" title="数据库基本概念"></a>数据库基本概念</h3><ol>
<li>Data 描述事物的符号记录</li>
<li>DB(database) 存储数据的仓库，保存一系列有组织的数据</li>
<li>DBMS(Database Management System) 可以操纵DB</li>
<li>DBS DB和DBMS的总体描述</li>
</ol>
<h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><p>关系模型由一组关系组成，每个关系的数据结构是一张规范化的二维表，<br>一般的描述方式为 关系名（属性1，属性2，···，属性n），关系的每<br>一个属性值都必须是一个不可分的数据项，也就是说不允许表中还有表<br>，关系模型的数据操纵主要包括查询、插入、删除和更新，这些操作都<br>需要满足关系的完整性约束条件</p>
<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>结构化查询语言(Structured Query Language)是关系数据库的标准语<br>言，包括查询、数据库模式创建、数据的删除修改等一些列功能，SQL语句<br>不区分大小写</p>
<ul>
<li>DQL 查询语句 主要由select组成</li>
<li>DML 数据操作语言，主要由insert、update和delete组成</li>
<li>DDL 数据定义语言，主要由create、alter、drop和truncate组成</li>
<li>DCL 数据控制语言，主要由grant和revoke组成</li>
<li>TCL 事务控制语句 主要由commit、rollback和savepoint组成</li>
</ul>
<h3 id="MySQL使用"><a href="#MySQL使用" class="headerlink" title="MySQL使用"></a>MySQL使用</h3><p><img src="/2020/02/28/Mysql/number1.jpg" alt></p>
<h3 id="MySQL基本命令"><a href="#MySQL基本命令" class="headerlink" title="MySQL基本命令"></a>MySQL基本命令</h3><p>默认以分号作为命令结束</p>
<ol>
<li>显示所有数据库，mysql保存用户信息，information_schema保存原数据  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| gaoming            |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sakila             |</span><br><span class="line">| sys                |</span><br><span class="line">| world              |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure></li>
<li>切换数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use gaoming;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure></li>
<li>显示数据库中的所有表，如果没进入gaoming则需要加from gaoming<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_gaoming |</span><br><span class="line">+-------------------+</span><br><span class="line">| gao               |</span><br><span class="line">| person            |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure></li>
<li>查看当前处于哪个数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database();</span><br><span class="line">+------------+</span><br><span class="line">| database() |</span><br><span class="line">+------------+</span><br><span class="line">| gaoming    |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure></li>
<li>创建一个表<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table suinfo(</span><br><span class="line">id int,name varchar(20));</span><br></pre></td></tr></table></figure></li>
<li>查看表结构<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc suinfo;</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure></li>
<li>查看所有数据<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from suinfo;</span><br></pre></td></tr></table></figure></li>
<li>插入数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into suinfo(id,name) values(1,&#39;john&#39;);</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from suinfo;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 | john |</span><br><span class="line">+------+------+</span><br></pre></td></tr></table></figure></li>
<li>修改数据</li>
<li>删除数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update suinfo set name&#x3D;&#39;lilei&#39; where id&#x3D;1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from suinfo;</span><br><span class="line">+------+-------+</span><br><span class="line">| id   | name  |</span><br><span class="line">+------+-------+</span><br><span class="line">|    1 | lilei |</span><br><span class="line">+------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from suinfo where id&#x3D;1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from suinfo;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>查看数据库版本,或者在cmd mysql –version<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 8.0.16    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>不区分大小写，每条命令可以缩进或者换行，单行注释 #</li>
</ol>
<h2 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h2><ol>
<li>基础查询<br>select 查询列表 from 表名;查询列表可以是表中的字段、常量<br>、表达式、函数，查询  结果是虚拟表单。特殊字段可以加着重号<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from suinfo;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| ui   |</span><br><span class="line">| op   |</span><br><span class="line">+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
可以给字段起别名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select id as iid,name as mane from suinfo;</span><br><span class="line">+------+------+</span><br><span class="line">| iid  | mane |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 | ui   |</span><br><span class="line">|    2 | op   |</span><br><span class="line">+------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>select distinct id from suinfo 去除重复id</li>
<li>+号可以将多个字段连成一个，作用只有运算。如果两个字段都<br>是数字则可以加法运算，  如果其中一个是字符，会试图将字符转<br>换为数字进行运算。 select ‘123’+90;  select ‘john’+90;<br>结果是90,将字符型转换为0。其中一个为null则结果为null。</li>
<li>concat可以连接两个字段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(id,name) from suinfo;</span><br><span class="line">+-----------------+</span><br><span class="line">| concat(id,name) |</span><br><span class="line">+-----------------+</span><br><span class="line">| 1ui             |</span><br><span class="line">| 2op             |</span><br><span class="line">+-----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>ifnull(name,’ffds’) 判断是否为null如果为null就赋默认值</li>
<li>条件查询，通过where筛选条件。<br>按条件表达式 &gt; &lt; = !=(&lt;&gt;) &gt;= &lt;=<br>按逻辑表达式 &amp;&amp; || ! and or not<br>模糊查询 like ,between and ,in(只要满足其中一项，不支持通<br>配符), is null  &lt;=&gt;安全等于可以判断null和普通类型值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from suinfo where id between 1 and 10;</span><br><span class="line">select * from suinfo where name in(&#39;fds&#39;,&#39;vxc&#39;,&#39;rw&#39;);</span><br><span class="line">select * from suinfo where name is null;</span><br><span class="line">select * from suinfo where name is not null;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from suinfo where id&#x3D;2;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| op   |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>模糊查询不是精确匹配,%代表任意多个字符，_代表单个字<br>符，\转义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from suinfo where name like &#39;%P%&#39;;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    2 | op   |</span><br><span class="line">+------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure></li>
<li>select * from employes where name like ‘%%’与<br>select * from employes不一样  前者可能为null的话就不<br>会查询出来，后者查询所有</li>
<li>排序查询，asc是由低到高，desc是由高到低，支持别名，<br>也支持多个条件排序逗号隔开<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from suinfo where id&gt;&#x3D;1 order by name asc;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | name |</span><br><span class="line">+------+------+</span><br><span class="line">|    2 | op   |</span><br><span class="line">|    1 | ui   |</span><br><span class="line">+------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>length(‘jhon’) 返回字符长度</li>
<li>常见函数一般分为单行函数和分组函数，单行concat length ifnull<br>分组函数 一组值变为一个值<br>字符函数,一个汉字三个字节，length获取字节个数,upper变大写，lower变小写<br>substr(str,index)，索引从1开始，substr(str,from,to)，包含to<br>instr(str,strr) 获取起始索引，如果不匹配返回0<br>trim(str) 去掉前后空格<br>lpad(str,number,strr) 左填充字符<br>rpad(str,number,strr) 右填充字符<br>replace(str,str1,str2)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">select length(&#39;jhon&#39;);</span><br><span class="line">select length(&#39;张三风&#39;);</span><br><span class="line">mysql&gt; select upper(name) from suinfo;</span><br><span class="line">+-------------+</span><br><span class="line">| upper(name) |</span><br><span class="line">+-------------+</span><br><span class="line">| UI          |</span><br><span class="line">| OP          |</span><br><span class="line">+-------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line">mysql&gt; select substr(&#39;你好啊高明&#39;,3);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&#39;你好啊高明&#39;,3) |</span><br><span class="line">+------------------------+</span><br><span class="line">| 啊高明                 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">mysql&gt; select instr(&#39;高明爱上了谁&#39;,&#39;爱&#39;);</span><br><span class="line">+----------------------------+</span><br><span class="line">| instr(&#39;高明爱上了谁&#39;,&#39;爱&#39;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                          3 |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">select trim(&#39;   fsd   &#39;);</span><br><span class="line">select trim(&#39;a&#39; from &#39;aaafsdfdaaa&#39;);</span><br><span class="line">mysql&gt; select lpad(&#39;高明你好啊小老弟&#39;,15,&#39;*&#39;);</span><br><span class="line">+---------------------------------+</span><br><span class="line">| lpad(&#39;高明你好啊小老弟&#39;,15,&#39;*&#39;) |</span><br><span class="line">+---------------------------------+</span><br><span class="line">| *******高明你好啊小老弟         |</span><br><span class="line">+---------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select replace(&#39;周芷若爱上张无忌&#39;,&#39;周芷若&#39;,&#39;赵敏&#39;);</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| replace(&#39;周芷若爱上张无忌&#39;,&#39;周芷若&#39;,&#39;赵敏&#39;) |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">| 赵敏爱上张无忌                              |</span><br><span class="line">+---------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>数学函数<br>round(number) 四舍五入<br>round(number,2) 小数点后保留两位<br>ceil(number) 向上取整<br>floor(number) 向下取整<br>truncate(number,2) 小数点后阶段2位<br>mod(number1,number2) number1%number2</li>
<li>日期函数<br>now() 返回当前日期+时间<br>curdate() 返回当前日期<br>curtime() 返回当前时间<br>year(now()) month(now()) monthname()<br>str_to_date(‘4-3 1999’,’%c-%d %Y’)=’1999-4-3’ 可以解析  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select date_format(now(),&#39;%y年%m月%d日&#39;);</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| date_format(now(),&#39;%y年%m月%d日&#39;) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| 20年03月05日                      |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure></li>
<li>其他函数<br>version() database() </li>
<li>流程控制函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * ,if(id&gt;1,&#39;大&#39;,&#39;小&#39;) from suinfo;</span><br><span class="line">+------+------+--------------------+</span><br><span class="line">| id   | name | if(id&gt;1,&#39;大&#39;,&#39;小&#39;) |</span><br><span class="line">+------+------+--------------------+</span><br><span class="line">|    1 | ui   | 小                 |</span><br><span class="line">|    2 | op   | 大                 |</span><br><span class="line">+------+------+--------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select *,case id</span><br><span class="line">    -&gt; when 1 then id*2</span><br><span class="line">    -&gt; when 2 then id*3</span><br><span class="line">    -&gt; else id*4</span><br><span class="line">    -&gt; end as iid</span><br><span class="line">    -&gt; from suinfo;</span><br><span class="line">+------+------+------+</span><br><span class="line">| id   | name | iid  |</span><br><span class="line">+------+------+------+</span><br><span class="line">|    1 | ui   |    2 |</span><br><span class="line">|    2 | op   |    6 |</span><br><span class="line">+------+------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select id,case</span><br><span class="line">    -&gt; when id&gt;1 then &#39;a&#39;</span><br><span class="line">    -&gt; when id&gt;0 then &#39;b&#39;</span><br><span class="line">    -&gt; else &#39;c&#39;</span><br><span class="line">    -&gt; end as &#39;idi&#39; from suinfo;</span><br><span class="line">+------+-----+</span><br><span class="line">| id   | idi |</span><br><span class="line">+------+-----+</span><br><span class="line">|    1 | b   |</span><br><span class="line">|    2 | a   |</span><br><span class="line">+------+-----+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>分组函数<br>count是非空的值有多少个，sum和avg只能用于数值，除了count都忽略null，可以和distinct<br>搭配，count(*)只要有一个字段不为null该行仍然被统计，count(1) 相当于多了一列1统计<br>所有行<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sum(id) from suinfo;</span><br><span class="line">+---------+</span><br><span class="line">| sum(id) |</span><br><span class="line">+---------+</span><br><span class="line">|       3 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">mysql&gt; select avg(id) as avg,min(id) as min ,</span><br><span class="line">    -&gt; max(id) as max,count(id) as count from suinfo;</span><br><span class="line">+--------+------+------+-------+</span><br><span class="line">| avg    | min  | max  | count |</span><br><span class="line">+--------+------+------+-------+</span><br><span class="line">| 1.5000 |    1 |    2 |     2 |</span><br><span class="line">+--------+------+------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">select sum(distinct id) from suinfo;</span><br><span class="line">select count(*) from suinfo;</span><br></pre></td></tr></table></figure></li>
<li>select 列 from 表 where 条件 group by 列表 order by 子句<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select max(id) ,id from suinfo group by id;</span><br><span class="line">+---------+------+</span><br><span class="line">| max(id) | id   |</span><br><span class="line">+---------+------+</span><br><span class="line">|       1 |    1 |</span><br><span class="line">|       2 |    2 |</span><br><span class="line">+---------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
having是分组后的筛选，where是分组前的筛选，group by 后面也可以跟表达式，也可以跟<br>多个字段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*),id from suinfo</span><br><span class="line">    -&gt; group by id</span><br><span class="line">    -&gt; having count(*)&gt;1;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>连接查询<br>笛卡尔乘积现象，如果为表起了别名就只能使用别名不能再用表名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from suu;</span><br><span class="line">+------+--------+</span><br><span class="line">| nuid | nuname |</span><br><span class="line">+------+--------+</span><br><span class="line">|  100 | rwd    |</span><br><span class="line">|  101 | fasd   |</span><br><span class="line">+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  name,nuname from suinfo,suu;</span><br><span class="line">+------+--------+</span><br><span class="line">| name | nuname |</span><br><span class="line">+------+--------+</span><br><span class="line">| ui   | rwd    |</span><br><span class="line">| op   | rwd    |</span><br><span class="line">| ui   | fasd   |</span><br><span class="line">| op   | fasd   |</span><br><span class="line">+------+--------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">mysql&gt; select e.name,j.nuname from suinfo as e,suu as j</span><br><span class="line">    -&gt; where e.id+99&#x3D;j.nuid;</span><br><span class="line">+------+--------+</span><br><span class="line">| name | nuname |</span><br><span class="line">+------+--------+</span><br><span class="line">| ui   | rwd    |</span><br><span class="line">| op   | fasd   |</span><br><span class="line">+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>自连接<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.id,j.id</span><br><span class="line">    -&gt; from suinfo as e,suinfo as j</span><br><span class="line">    -&gt; where e.id+1&#x3D;j.id;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | id   |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    2 |</span><br><span class="line">+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>sql99<br>select 查询列表 from 表1 连接类型 join 表2 on 连接条件 where 筛选条件<br>group by 分组 having 筛选条件 order by 排序列表<br>内连接 inner 外连接 left right 全外：full 交叉连接 cross<br>多表连接时可以先所有行连接一起然后根据条件进行删减，比如e.id在j的lowid和<br>highid之间，一行行比对<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select name from suinfo as e</span><br><span class="line">    -&gt; inner join suu as j;</span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| ui   |</span><br><span class="line">| op   |</span><br><span class="line">| ui   |</span><br><span class="line">| op   |</span><br><span class="line">+------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line">select id from suinfo as e</span><br><span class="line">inner join suu as j</span><br><span class="line">on e.id between j.lowid and j.highid;</span><br></pre></td></tr></table></figure></li>
<li>外连接<br>分为主表和从表，如果主表和从表不匹配依然显示从表信息，不过为null，相当于内连接+<br>主表有而从表没有的信息，多了一行null<br>左外连接：left join左边的是主表<br>右外连接：right join右边的是主表<br>全外连接：funn join 内连接结果+表1有但表2没有+表2有但表1没有<br>交叉连接：cross join<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.id,j.nuid</span><br><span class="line">    -&gt; from suinfo as e</span><br><span class="line">    -&gt; left outer join suu as j</span><br><span class="line">    -&gt; on e.id&#x3D;j.nuid;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | nuid |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 | NULL |</span><br><span class="line">|    2 | NULL |</span><br><span class="line">+------+------+</span><br><span class="line">mysql&gt; select e.*,j.*</span><br><span class="line">    -&gt; from suinfo e</span><br><span class="line">    -&gt; cross join suu j;</span><br><span class="line">+------+------+------+--------+</span><br><span class="line">| id   | name | nuid | nuname |</span><br><span class="line">+------+------+------+--------+</span><br><span class="line">|    1 | ui   |  100 | rwd    |</span><br><span class="line">|    2 | op   |  100 | rwd    |</span><br><span class="line">|    1 | ui   |  101 | fasd   |</span><br><span class="line">|    2 | op   |  101 | fasd   |</span><br><span class="line">|    1 | ui   |    1 | vcx    |</span><br><span class="line">|    2 | op   |    1 | vcx    |</span><br><span class="line">+------+------+------+--------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li>子查询<br>出现在其他语句内部的select语句称之为子查询<br>select后面支持标量子查询（一行一列），from后面支持表子查询（多行多列），where或<br>having后面支持标量、列（一列多行）、行子查询（一行多列），exists后面支持表子查询</li>
<li>标量子查询<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from suinfo</span><br><span class="line">where salary&gt;(</span><br><span class="line">	select salary</span><br><span class="line">	from suu where name&#x3D;&#39;fsd&#39;</span><br><span class="line">	)</span><br></pre></td></tr></table></figure></li>
<li>列子查询<br>in/not in 等于列表中的任意一个，any/some与列表中的某一个，存在即可<br>all和子查询返回的所有值比较</li>
<li>行子查询（一行多列或者多行多列）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from suinfo </span><br><span class="line">where (id,salary)&#x3D;(</span><br><span class="line">	select min(id),max(salary) from suinfo;</span><br><span class="line">	)</span><br></pre></td></tr></table></figure></li>
<li>select后面的子查询<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select d.*,(</span><br><span class="line">	select count(*)</span><br><span class="line">	from employee e</span><br><span class="line">	where e.id&#x3D;d.id</span><br><span class="line">	) 个数</span><br><span class="line">	from depart d;</span><br></pre></td></tr></table></figure></li>
<li>from后面的子查询<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select e.*,g.level</span><br><span class="line">from (</span><br><span class="line">	select avg(salary) ag,id</span><br><span class="line">	from employee group by id</span><br><span class="line">	) e</span><br><span class="line">	inner join grade g</span><br><span class="line">	on e.ag between g.low and g.high</span><br></pre></td></tr></table></figure></li>
<li>exist<br>判断子查询的结果是否存在，若存在返回1不存在返回0<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select exist(select id from employee);</span><br></pre></td></tr></table></figure></li>
<li>分页查询<br>当要显示的数据一页显示不全需要分页提交sql请求<br>limit放在所有sql语句最后最后 limit offset,size,offset从0开始显示size条数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from suinfo limit 0,10;</span><br></pre></td></tr></table></figure></li>
<li>联合查询<br>将多条查询语句的结果合并成一个结果，取并集。查询语句的列数必须相同，每一列的类型<br>和顺序最好一致，默认去重如果不去重使用union all<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from suinfo where name like &#39;%a%&#39;</span><br><span class="line">union</span><br><span class="line">select * from suinfo where id&gt;9;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h2><p>与DDL操纵数据表不同，DML主要操作数据表里的数据，包含插入删除和修改</p>
<ol>
<li>插入数据，一次只能插入一条数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#表名后是所以列名，列名后是相应的值</span><br><span class="line">insert into test(id,name) values(1,&#39;xyz&#39;);</span><br><span class="line">#部分列名，其余列名为null，注意id是primary，所以不能替换为name</span><br><span class="line">insert into test(id) values(2);</span><br><span class="line">#也可以省略列名</span><br><span class="line">insert into test values(3,&#39;lkj&#39;);</span><br><span class="line">#扩展语法，可以同时插入多个值</span><br><span class="line">insert into test values(5,&#39;lkj&#39;),(6,&#39;va&#39;);</span><br></pre></td></tr></table></figure></li>
<li>修改语句<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update suinfo set name&#x3D;&#39;mn&#39;</span><br><span class="line">    -&gt; where id&#x3D;7;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure></li>
<li>修改多表<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update suinfo e</span><br><span class="line">inner join suu j on e.id&#x3D;j.nuid</span><br><span class="line">set j.nuname&#x3D;&#39;uio&#39; where e.name&#x3D;&#39;uio&#39;;</span><br></pre></td></tr></table></figure></li>
<li>删除语句<br>delete可以加where，truncate 不能加where，多表删除时可以实现删除一个表的信息也<br>可以删除多表信息，如果删除的表中有自增长列，如果使用delete删除再插入会从断点开始<br>如果使用truncate删除再插入会从1开始。delete有返回值truncate没有返回值，truncate<br>删除不能回滚delete可以回滚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from suinfo where id&#x3D;5;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">delete b from suinfo b inner join suu j on b.id&#x3D;j.nuid where j.name&#x3D;&#39;fd&#39;;</span><br><span class="line">delete b,j from suinfo b inner join suu j on b.id&#x3D;j.nuid where j.name&#x3D;&#39;fd&#39;;</span><br><span class="line">truncate table suinfo;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><p>操作数据库对象，包括创建删除和修改 <img src="/2020/02/28/Mysql/1.jpg" alt></p>
<ol>
<li>创建库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database book default character set utf8mb4;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br></pre></td></tr></table></figure></li>
<li>删除库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database book;</span><br><span class="line">Query OK, 0 rows affected (0.10 sec)</span><br></pre></td></tr></table></figure></li>
<li>创建表 <img src="/2020/02/28/Mysql/2.jpg" alt> <img src="/2020/02/28/Mysql/3.jpg" alt><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">	#列名 列的类型</span><br><span class="line">	id int,price decimal,name varchar(20),desc text,img blog</span><br><span class="line">	);</span><br></pre></td></tr></table></figure></li>
<li>表的修改<br>可以修改列名和类型，一次只能修改一个列定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#修改列名</span><br><span class="line">mysql&gt; alter table suu change  nuid nnid int;</span><br><span class="line">#修改列类型</span><br><span class="line">mysql&gt; alter table suu modify  nnid varchar(20);</span><br></pre></td></tr></table></figure></li>
<li>添加新列，需要注意如果数据表中已经有数据，除非给新列指定默认值，<br>否则新增的数据列不可指定非空约束，因为已有的数据在新列上一定是空的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu add </span><br><span class="line">(id int,name varchar(20) default &#39;xxx&#39;);</span><br></pre></td></tr></table></figure></li>
<li>删除新列<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu drop id;</span><br></pre></td></tr></table></figure></li>
<li>修改表名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table suu rename to su;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure></li>
<li>表的删除<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#表的结构也被删除</span><br><span class="line">mysql&gt; drop table su;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">#只删除数据，不删除表的结构，只能一次性删除所有数据</span><br><span class="line">truncate su;</span><br></pre></td></tr></table></figure></li>
<li>表的复制<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#仅仅复制表的结构</span><br><span class="line">mysql&gt; create table copy like suinfo;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">#复制表的结构和数据，也可以复制部分数据</span><br><span class="line">mysql&gt; create table copy select * from suinfo;</span><br><span class="line">Query OK, 6 rows affected (0.04 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h3><p>所有的关系数据库都支持对数据表使用约束，约束是在表上强制执行的数据<br>校验规则，主要用于保证数据的完整性，除此以外当表中的数据存在相互依<br>赖时可以保护相关的数据不被删除。可以分为单列约束和多列约束，指定约<br>束有两个时机，可以在创建表的同时为相应的数据列指定约束，或创建表后<br>以修改表的方式来增加约束</p>
<ul>
<li>not null 非空约束，该字段不能为空   </li>
<li>primary key 主键保证唯一性并且非空  </li>
<li>unique 字段值具有唯一性但是可以为空   </li>
<li>foreign key 外键用于限制两个表的关系保证该字段的值来自主表的关<br>联列的值，在从表中添加外键约束用于引用主表某列的值</li>
</ul>
<ol>
<li>非空约束 所有数据类型的值都可以是null，只能作为列级约束使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table hehe</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    name varchar(20) default &#39;xyz&#39; not null,</span><br><span class="line">    #默认就是空</span><br><span class="line">    gender varchar(2) null</span><br><span class="line">);</span><br><span class="line">#也可以修改表</span><br><span class="line">alter table hehe</span><br><span class="line">modify gender varchar(2) not null;</span><br><span class="line">alter table hehe</span><br><span class="line">modify id int(11) null;</span><br><span class="line">alter table hehe</span><br><span class="line">modify name varchar(3) default &#39;abc&#39; null;</span><br></pre></td></tr></table></figure></li>
<li>unique约束 唯一约束用于保证指定列或指定列组合不允许出现重复值，<br>但是可以出现null，在数据库中null不等于null。同一个表中可以建立多<br>个唯一约束，唯一约束也可以由多个列组成，如果不给唯一约束起名则默<br>认与列名相同，如果需要为多列组合约束或者为唯一约束指定约束名则只<br>能使用表级约束<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    #列级约束</span><br><span class="line">    name varchar(20) unique</span><br><span class="line">);</span><br><span class="line">create table test2</span><br><span class="line">(</span><br><span class="line">	id int not null,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    #表级约束</span><br><span class="line">    unique(name),</span><br><span class="line">    #表级约束并制定约束名</span><br><span class="line">    constraint uk unique(pass)</span><br><span class="line">);</span><br><span class="line">create table test3</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    #两列组合建立唯一约束，一般是要取表名，要不然删除没有名字无法将组合约束删除</span><br><span class="line">    constraint uuk unique(name,pass)</span><br><span class="line">);</span><br><span class="line">create table test4</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20)</span><br><span class="line">);</span><br><span class="line">#表级约束语法也可以放在alter语句中，为两列组合建立唯一约束</span><br><span class="line">alter table test4</span><br><span class="line">add unique(name,pass);</span><br><span class="line">#使用列级约束语法</span><br><span class="line">alter table test4</span><br><span class="line">modify pass varchar(30) unique;</span><br><span class="line"># drop index 约束名</span><br><span class="line">alter table test3</span><br><span class="line">drop index uuk;</span><br></pre></td></tr></table></figure></li>
<li>primary key 主键约束相当于非空约束和唯一约束，不能出现重复<br>值也不能出现null值，如果对多列组合建立唯一约束，则多列组合里每<br>一列都不能为空，每一个表中最多允许有一个主键，但是可以由多个列<br>组成，不管是否指定约束名，Mysql总是将所有主键约束命名为primary<br>很多数据库对主键列都支持自增长特性，如果某个数据列是整型并且是<br>主键列那么可以指定该列具有自增长功能，而且插入时不可以为该列指<br>定值，可以用null替代，数据由数据库自动生成<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	#主键约束，采用列级约束语法</span><br><span class="line">	id int primary key,</span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br><span class="line">create table test2</span><br><span class="line">(</span><br><span class="line">	id int,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    #表级约束，不需要指定约束名</span><br><span class="line">    constraint primary key(id)</span><br><span class="line">);</span><br><span class="line">create table test3</span><br><span class="line">(</span><br><span class="line">	id int,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    #表级约束，不需要指定约束名</span><br><span class="line">    constraint primary key(id,name)</span><br><span class="line">);</span><br><span class="line">#删除主键约束</span><br><span class="line">alter table test3</span><br><span class="line">drop primary key;</span><br><span class="line">#表级约束语法</span><br><span class="line">alter table test3</span><br><span class="line">add primary key(id,name);</span><br><span class="line">#如果只是单独列增加主键约束可以使用modify</span><br><span class="line">alter table test3</span><br><span class="line">modify name varchar(200) primary key;</span><br></pre></td></tr></table></figure></li>
<li>foregin key 外键约束用于保证一个或两个表之间的参照完整性，外键<br>是构建于一个表的两个字段或者两个表的两个字段之间的参照关系。子表外<br>键列的值必须在主表被参照列的范围之内，或者为空。子表参照的只能是主<br>表主键列或者是唯一键列，同一个表内可以拥有多个外键。外键约束通常用<br>于学生与老师之间的对应关系，外键约束不仅可以参照其他表也可以参照<br>自身，被称为自关联，比如一个部门的经理与员工。如果想定义删除主表<br>记录时将从表的记录也删除，则需要在外键约束的最后添加on delete<br>cascade或on delete set null，第一种是删除主表记录时将从表记<br>录全部级联删除，第二种是将外键设置为null<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">create table teacher</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br><span class="line">#Mysql并不支持这种列级语法</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int references teacher(id)</span><br><span class="line">);</span><br><span class="line">#Mysql支持表级约束</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int,</span><br><span class="line">    foreign key(teacherid) references teacher(id)</span><br><span class="line">);</span><br><span class="line">#constraint可以显示指定从表的名字</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    teacherid int,</span><br><span class="line">    constraint stuteach foreign key(teacherid) references</span><br><span class="line">    teacher(id)</span><br><span class="line">);</span><br><span class="line">#多列组合的外键约束必须使用表级语法</span><br><span class="line">create table teacher</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    primary key(name,pass)</span><br><span class="line">);</span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">	name varchar(20),</span><br><span class="line">    pass varchar(20),</span><br><span class="line">    foreign key(name,pass) references</span><br><span class="line">    teacher(name,pass)</span><br><span class="line">);</span><br><span class="line">#删除外键约束，默认外键约束名是table_name_ibfk_n</span><br><span class="line">alter table student</span><br><span class="line">drop foreign key student_ibfk_1;</span><br><span class="line">#增加外键约束</span><br><span class="line">alter table student</span><br><span class="line">add foreign key(name,pass) references </span><br><span class="line">teacher(name,pass);</span><br><span class="line">#自关联</span><br><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">	id int auto_increment primary key,</span><br><span class="line">    namr varchar(20),</span><br><span class="line">    foreign key(id) references test(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>索引是存放在模式中的一个数据库对象，虽然索引总是从属于数据表，但是<br>和数据表一样属于数据库对象。创建索引的唯一作用就是加速对表的查询，<br>索引通过快速路径访问方法来快速定位数据。创建索引有两种方式</p>
<ul>
<li>当在表上定义主键约束、唯一约束和外键约束时，系统会自动为数据列创<br>建对应的索引</li>
<li>可以通过create index创建索引</li>
</ul>
<p>删除索引也有两种方式</p>
<ul>
<li>数据表被删除，相应的索引也被删除</li>
<li>drop index删除索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create index index_name on test(name);</span><br><span class="line">create index twoboth on test(id,name);</span><br><span class="line">#Mysql只要求同一个表中的索引不能重复</span><br><span class="line">drop index index_name on test;</span><br></pre></td></tr></table></figure>

<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图像一个数据表当不是数据表，因为视图并不能存储数据，只是一个或多个数据<br>表中数据的逻辑显示。视图的本质就是一条被命名为sql的查询语句，有以下好处</p>
<ul>
<li>可以限制对数据的访问</li>
<li>可以使复杂的查询变得简单</li>
<li>提供了数据的独立性</li>
<li>提供对先沟通数据的不同显示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create or replace view viewname</span><br><span class="line">as subquery</span><br><span class="line">#创建视图并且不允许修改数据，通常不允许修改视图数据</span><br><span class="line">create view viewtest as select id from test with check option;</span><br><span class="line">#删除视图</span><br><span class="line">drop view viewtest;</span><br></pre></td></tr></table></figure>



<h2 id="事务TCL"><a href="#事务TCL" class="headerlink" title="事务TCL"></a>事务TCL</h2><p>一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么都不执行<br>mysql中的存储引擎innodb支持事务</p>
<h3 id="事务的属性"><a href="#事务的属性" class="headerlink" title="事务的属性"></a>事务的属性</h3><ul>
<li>原子性，是不可再分割的单位，要么都发生要么都不发生</li>
<li>一致性，数据库从一个一致性状态变换到另一个一致性状态</li>
<li>隔离性，一个事务不被其他事务干扰，根据隔离级别</li>
<li>持久性，一个事务一旦提交对数据的改变是永久性的</li>
</ul>
<h3 id="事务的创建"><a href="#事务的创建" class="headerlink" title="事务的创建"></a>事务的创建</h3><p>隐式事务没有明显开启和结束的标记 insert update delete<br>首先设置禁用自动提交功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set autocommit&#x3D;0;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>编写事务(select insert update delete)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update pperson set age&#x3D;10 where name&#x3D;&#39;op&#39;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<h3 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h3><p>对于同时运行的多个事务，当这些事务访问数据库中相同的数据时，如果没有采取必要的隔离<br>机制，就会导致各种并发问题</p>
<ul>
<li>脏读 一个事务读取数据另一个事务更新数据但没提交，若这个事务回滚则读取的数据临时无效</li>
<li>不可重复读 一个事务读取数据，另一个事务的数据修改数据，前后数据不一样</li>
<li>幻读 一个事务读取数据，另一个事务插入新的数据，前后数据不一样</li>
</ul>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">set session transaction isolation level read committed; #设置隔离级别</span><br><span class="line">mysql&gt; select @@transaction_isolation;</span><br><span class="line">+-------------------------+</span><br><span class="line">| @@transaction_isolation |</span><br><span class="line">+-------------------------+</span><br><span class="line">| REPEATABLE-READ         |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li>read uncommitted 不能避免问题</li>
<li>read committed 可以避免脏读</li>
<li>repeatable read 可以解决脏读和不可重复读，mysql默认</li>
<li>serializable 可以解决任何问题 </li>
</ul>
<h3 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">savepoint a;#设置保存点</span><br><span class="line">....</span><br><span class="line">rollback to a;回滚到a</span><br></pre></td></tr></table></figure>
<h2 id="视图-1"><a href="#视图-1" class="headerlink" title="视图"></a>视图</h2><p>虚拟表，和普通表一样并且通过动态生成，只保存sql逻辑，不保存数据<br>比较复杂的查询可以使用视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create view v1</span><br><span class="line">    -&gt; as</span><br><span class="line">    -&gt; select * from pperson;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from v1 where sex&#x3D;1;</span><br><span class="line">+----+------+------+------+-------------+---------------+</span><br><span class="line">| id | name | age  | sex  | homeaddress | schooladdress |</span><br><span class="line">+----+------+------+------+-------------+---------------+</span><br><span class="line">|  4 | vx   |   21 |    1 | sz          | gz            |</span><br><span class="line">|  6 | nm   |   31 |    1 | sz          | gz            |</span><br><span class="line">+----+------+------+------+-------------+---------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">desc v1;</span><br><span class="line">mysql&gt; drop view v1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<h3 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h3><p>视图可以进行增删改，相应的table也会更改。一般不修改视图<br>具备以下特点的视图不可以修改</p>
<ul>
<li>distinct group by having union union all</li>
<li>select 包含子查询</li>
</ul>
<h3 id="视图和表"><a href="#视图和表" class="headerlink" title="视图和表"></a>视图和表</h3><p>视图不占用物理空间，只保存sql逻辑，都可以进行增删改查</p>
<h3 id="delete和truncate在事务中的区别"><a href="#delete和truncate在事务中的区别" class="headerlink" title="delete和truncate在事务中的区别"></a>delete和truncate在事务中的区别</h3><p>声明事务后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete from pperson;</span><br><span class="line">rollback; #依然有数据</span><br><span class="line">truncate table pperson;</span><br><span class="line">rollback; #数据消失，不支持回滚</span><br></pre></td></tr></table></figure>
<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul>
<li>系统变量：全局变量，会话变量（本会话有效），由系统提供</li>
<li>自定义变量：用户变量（当前会话），局部变量（begin end）</li>
</ul>
<ol>
<li>show global/session variables; 查看系统变量</li>
<li>set @用户变量名:=值; 声明并初始化</li>
<li>declare 变量名 类型; set 局部变量名:=值;</li>
</ol>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>一组预先编译好的sql语句的集合，理解成批处理语句，可以提高代码重用性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter 结束标记 $</span><br><span class="line">create procedure 存储过程名(参数列表) #参数模式 参数名 参数类型</span><br><span class="line">begin </span><br><span class="line">	方法体</span><br><span class="line">end $</span><br><span class="line">call 存储过程名(实参列表) $</span><br></pre></td></tr></table></figure>
<h3 id="参数模式"><a href="#参数模式" class="headerlink" title="参数模式"></a>参数模式</h3><ul>
<li>in 可以作为输入，也就是需要调用时存入值</li>
<li>out 可以作为输出。作为返回值</li>
<li>inout 既可以作为输入也可以作为输出</li>
</ul>
<p>in</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure mm(in beauty varchar(20),in id varchar(20))</span><br><span class="line">begin</span><br><span class="line">	declare result int default 0;</span><br><span class="line">	select count(*) into result</span><br><span class="line">	from person</span><br><span class="line">	where</span><br><span class="line">	...</span><br><span class="line">	select result;</span><br><span class="line">end $</span><br><span class="line">call mm(&#39;df&#39;,234)$</span><br></pre></td></tr></table></figure>
<p>out</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure my(in beautyname varchar(20),out boyname varchar(20),..)</span><br><span class="line">begin</span><br><span class="line">	select bo.name... into boyname,..</span><br><span class="line">	from boys bo</span><br><span class="line">	inner join beauty b on bo.id&#x3D;b.boyid</span><br><span class="line">	where b.name&#x3D;beautyname;</span><br><span class="line">end $</span><br><span class="line">set @boy$</span><br><span class="line">call my(&#39;fds&#39;,@boy)$</span><br><span class="line">select @boy$</span><br></pre></td></tr></table></figure>
<p>删除存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure my</span><br></pre></td></tr></table></figure>
<p>查看存储过程的结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create procedure my;</span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>存储过程可以有多个返回值，函数只有一个返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create function 函数名(参数列表) returns 返回类型</span><br><span class="line">begin </span><br><span class="line">	declare c int default 0;</span><br><span class="line">	函数体</span><br><span class="line">	return c;</span><br><span class="line">end</span><br><span class="line">select 函数名(参数列表)</span><br></pre></td></tr></table></figure>
<p>查看函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create function mm;</span><br></pre></td></tr></table></figure>
<p>删除函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop function mm;</span><br></pre></td></tr></table></figure>
<h2 id="流程控制结构"><a href="#流程控制结构" class="headerlink" title="流程控制结构"></a>流程控制结构</h2><ul>
<li>if(表达式1,表达式2,表达式3)  如果1成立返回2否则返回3</li>
<li>case when 条件1 then 1;when 条件2… end case</li>
<li>if 条件1 then 1 ;else if …  end if;</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">高明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://skysea-gaoming.github.io/2020/02/28/Mysql/">https://skysea-gaoming.github.io/2020/02/28/Mysql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DataBase/">DataBase</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/28/Mybatis/"><i class="fa fa-chevron-left">  </i><span>Mybatis</span></a></div><div class="next-post pull-right"><a href="/2020/02/28/Maven/"><span>Maven</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://skysea-gaoming.github.io/2020/02/28/Mysql/';
  this.page.identifier = '2020/02/28/Mysql/';
  this.page.title = 'Mysql';
}
var d = document, s = d.createElement('script');
s.src = "https://" + '你的disqus的 short-name' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://你的disqus的 short-name.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1599140437492&amp;di=195fa5a4bc93905108d4f72b9167b0c0&amp;imgtype=0&amp;src=http%3A%2F%2Fphoto.tuchong.com%2F443730%2Ff%2F14505255.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By 高明</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>