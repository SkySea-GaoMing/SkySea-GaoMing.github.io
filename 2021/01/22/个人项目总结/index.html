<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="抢课项目总结"><meta name="keywords" content="Java"><meta name="author" content="高明"><meta name="copyright" content="高明"><title>抢课项目总结 | SkySea-GaoMing</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#抢课项目"><span class="toc-number">1.</span> <span class="toc-text">抢课项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前后端分离的核心思想"><span class="toc-number">1.1.</span> <span class="toc-text">前后端分离的核心思想</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用架构"><span class="toc-number">3.</span> <span class="toc-text">应用架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#正向代理和反向代理"><span class="toc-number">3.1.</span> <span class="toc-text">正向代理和反向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web服务器的好处"><span class="toc-number">3.2.</span> <span class="toc-text">Web服务器的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前端相关配置"><span class="toc-number">3.3.</span> <span class="toc-text">前端相关配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#背景"><span class="toc-number">3.4.</span> <span class="toc-text">背景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目结构"><span class="toc-number">4.</span> <span class="toc-text">项目结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#java-com-soquickproject"><span class="toc-number">4.1.</span> <span class="toc-text">java.com.soquickproject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">4.1.1.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#controller"><span class="toc-number">4.1.2.</span> <span class="toc-text">controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dao"><span class="toc-number">4.1.3.</span> <span class="toc-text">dao</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dataobject"><span class="toc-number">4.1.4.</span> <span class="toc-text">dataobject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#error"><span class="toc-number">4.1.5.</span> <span class="toc-text">error</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#response"><span class="toc-number">4.1.6.</span> <span class="toc-text">response</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">4.1.7.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#validator"><span class="toc-number">4.1.8.</span> <span class="toc-text">validator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#APP"><span class="toc-number">4.1.9.</span> <span class="toc-text">APP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库文件"><span class="toc-number">4.2.</span> <span class="toc-text">数据库文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#功能"><span class="toc-number">5.</span> <span class="toc-text">功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#根据id获取User"><span class="toc-number">5.1.</span> <span class="toc-text">根据id获取User</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#学生根据手机号获取验证码"><span class="toc-number">5.2.</span> <span class="toc-text">学生根据手机号获取验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#request-setAttribute-和request-getSession-setAttribute"><span class="toc-number">5.3.</span> <span class="toc-text">request.setAttribute()和request.getSession().setAttribute()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#qs"><span class="toc-number">5.4.</span> <span class="toc-text">qs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#学生获取验证码后完成注册"><span class="toc-number">5.5.</span> <span class="toc-text">学生获取验证码后完成注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert和insertSelective"><span class="toc-number">5.6.</span> <span class="toc-text">insert和insertSelective</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#学生登录功能"><span class="toc-number">5.7.</span> <span class="toc-text">学生登录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理员创建课程"><span class="toc-number">5.8.</span> <span class="toc-text">管理员创建课程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#展示课程列表"><span class="toc-number">5.9.</span> <span class="toc-text">展示课程列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抢课活动模型创建"><span class="toc-number">5.10.</span> <span class="toc-text">抢课活动模型创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#秒杀抢课模型"><span class="toc-number">5.11.</span> <span class="toc-text">秒杀抢课模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#难点优化"><span class="toc-number">6.</span> <span class="toc-text">难点优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解决跨域"><span class="toc-number">6.1.</span> <span class="toc-text">解决跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#前端部分"><span class="toc-number">6.1.1.</span> <span class="toc-text">前端部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#后端部分"><span class="toc-number">6.1.2.</span> <span class="toc-text">后端部分</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化校验规则"><span class="toc-number">6.2.</span> <span class="toc-text">优化校验规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前后端交换数据优化"><span class="toc-number">6.3.</span> <span class="toc-text">前后端交换数据优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前端拿到数据viewobject"><span class="toc-number">6.4.</span> <span class="toc-text">前端拿到数据viewobject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#完善前后端返回对象"><span class="toc-number">6.4.1.</span> <span class="toc-text">完善前后端返回对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全"><span class="toc-number">7.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#校验"><span class="toc-number">7.1.</span> <span class="toc-text">校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#登录拦截"><span class="toc-number">7.2.</span> <span class="toc-text">登录拦截</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户信息加密"><span class="toc-number">7.3.</span> <span class="toc-text">用户信息加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加盐为什么能提高安全性？"><span class="toc-number">7.4.</span> <span class="toc-text">加盐为什么能提高安全性？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#认证方案（session-与-token）"><span class="toc-number">7.5.</span> <span class="toc-text">认证方案（session 与 token）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SESSION"><span class="toc-number">7.5.1.</span> <span class="toc-text">SESSION</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2762516417,1589137703&amp;fm=26&amp;gp=0.jpg"></div><div class="author-info__name text-center">高明</div><div class="author-info__description text-center">JAVA工程师</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">59</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">12</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SkySea-GaoMing</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">抢课项目总结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2021/01/22/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2021/01/22/个人项目总结/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="抢课项目"><a href="#抢课项目" class="headerlink" title="抢课项目"></a>抢课项目</h2><p>这是一个基于Vue+SpringBoot搭建的前后端分离抢课系统</p>
<h3 id="前后端分离的核心思想"><a href="#前后端分离的核心思想" class="headerlink" title="前后端分离的核心思想"></a>前后端分离的核心思想</h3><p>前后端分离的核心思想是前端页面通过ajax调用后端的restuful api传递JSON数据<br>进行交互</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Quick Scramble for Classes<br>基于前后端分离架构设计的抢课系统<br>前端框架 Vue+ElementUI 后端框架 SpringBoot+Mybatis<br>项目使用Mavne快速构建<br>项目应用领域驱动型的分层模型设计方式完成如下功能</p>
<ol>
<li>用户otp注册</li>
<li>登录</li>
<li>显示课程列表</li>
<li>显示课程详细信息</li>
<li>倒计时秒杀开始后抢课的基本流程</li>
</ol>
<h2 id="应用架构"><a href="#应用架构" class="headerlink" title="应用架构"></a>应用架构</h2><ul>
<li>用户界面层 用户看到的页面</li>
<li>服务层 向服务器发出请求后台接收请求</li>
<li>业务逻辑层 针对具体问题的操作</li>
<li>数据访问层 对数据库的操作</li>
<li>数据存储 数据库</li>
</ul>
<h3 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h3><p>在开发的时候，前端用前端的服务器（Nginx），后端用后端的服务器（Tomcat）<br>，当我开发前端内容的时候，可以把前端的请求通过前端服务器转发给后端（称<br>为反向代理）。</p>
<ol>
<li>正向代理 正向代理就是，你要访问一个网站，比如“谷弟弟”，然后发现访问<br>不到，于是你访问了一个能访问到“谷弟弟”的代理服务器，让它帮你拿到你想浏<br>览的页面</li>
<li>反向代理就是，你访问了一个网站，你以为它是“谷弟弟”，但其实它是“谷姐”<br>，“谷姐”知道你其实是想找她弟，就取回“谷弟弟”的内容给你看。作为用户的你<br>，是不知道有这个过程的，这么做是为了保护服务器，不暴露服务器的真实地址</li>
</ol>
<h3 id="Web服务器的好处"><a href="#Web服务器的好处" class="headerlink" title="Web服务器的好处"></a>Web服务器的好处</h3><p>把前端项目部署在web服务器中，把后端项目部署在应用服务器中</p>
<ul>
<li>可以实现反向代理，提高网站的安全性</li>
<li>方便维护，一些小的修改不必同时协调前后端开发人员</li>
<li>对静态资源的加载速度更快</li>
</ul>
<h3 id="前端相关配置"><a href="#前端相关配置" class="headerlink" title="前端相关配置"></a>前端相关配置</h3><p>设置反向代理，修改src\main.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 设置反向代理，前端请求默认发送到 http:&#x2F;&#x2F;localhost:8081&#x2F;api</span><br><span class="line">var axios &#x3D; require(&#39;axios&#39;)</span><br><span class="line">axios.defaults.baseURL &#x3D; &#39;http:&#x2F;&#x2F;localhost:8081&#x2F;soquick&#39;</span><br></pre></td></tr></table></figure>


<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>本科生每个学期开始都要选课。课程分为专业必修课和专业选修课。专业必修课容量<br>充足能够，保证每个学生都能选上，专业选修课的容量有限，只有部分学生能够选<br>上。对于选修课设置倒计时秒杀时间，未到秒杀时间时学生不能抢课，到达秒杀时<br>间进行抢课</p>
<ol>
<li>商品列表页获取秒杀商品列表</li>
<li>进入商品详情页获取秒杀商品详情</li>
<li>秒杀开始后进入下单确认页下单并支付成功</li>
</ol>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><h3 id="java-com-soquickproject"><a href="#java-com-soquickproject" class="headerlink" title="java.com.soquickproject"></a>java.com.soquickproject</h3><h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><p>创建CrosConfig类，实现WebMvcConfigurer解决跨域问题</p>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><p>controller是对响应进行处理的部分</p>
<h4 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h4><p>Data Access Object（数据访问对象，DAO）即用来操作数据库的对象。<br>对应mapping的映射文件生成相应的接口，这些接口中有基本的增删查改方法，<br>可以认为都是具有原子性的，具体实现功能由service完成</p>
<h4 id="dataobject"><a href="#dataobject" class="headerlink" title="dataobject"></a>dataobject</h4><p>mybatis-generator为数据库表自动生成的相关数据对象会存放在这个包下，<br>在mybatis-generator.xml文件中可以指定相应数据对象的名字</p>
<h4 id="error"><a href="#error" class="headerlink" title="error"></a>error</h4><p>定义通用的返回对象，如果程序中出现问题就应该返回相应的错误信息</p>
<h4 id="response"><a href="#response" class="headerlink" title="response"></a>response</h4><p>定义通用的返回对象</p>
<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><p>负责业务逻辑与功能相关的操作，为了进一步解耦合可以再创建impl包具体实<br>现相关逻辑</p>
<h4 id="validator"><a href="#validator" class="headerlink" title="validator"></a>validator</h4><h4 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h4><ol start="2">
<li>resources</li>
</ol>
<ul>
<li>mapping 自动生成数据库表的映射文件放在这个包下</li>
<li>application.properties</li>
<li>mybatis-generator.xml mybatis自动生成器自动生成工具，生成数据库文件的映射<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--生成DataObject类存放位置--&gt;</span><br><span class="line">&lt;javaModelGenerator targetPackage=</span><br><span class="line">	<span class="string">"com.soquickproject.dataobject"</span> targetProject=<span class="string">"src/main/java"</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">"enableSubPackages"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;property name=<span class="string">"trimStrings"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;/javaModelGenerator&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--生成映射文件存放位置--&gt;</span><br><span class="line">&lt;sqlMapGenerator targetPackage=<span class="string">"mapping"</span>  targetProject=</span><br><span class="line">	<span class="string">"src/main/resources"</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">"enableSubPackages"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;/sqlMapGenerator&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--生成Dao类存放位置--&gt;</span><br><span class="line">&lt;javaClientGenerator type=<span class="string">"XMLMAPPER"</span> targetPackage=</span><br><span class="line">	<span class="string">"com.soquickproject.dao"</span>  targetProject=<span class="string">"src/main/java"</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">"enableSubPackages"</span> value=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;/javaClientGenerator&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>pom.xml</li>
</ol>
<h3 id="数据库文件"><a href="#数据库文件" class="headerlink" title="数据库文件"></a>数据库文件</h3><ol>
<li>学生信息表 id name age gender telphone register_mode third_party_id</li>
<li>密码与用户主表信息需要分开存储，为了安全这里存储的密码是加密后的密码而不<br>是真实的密码 id encrpt_password user_id</li>
</ol>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><h3 id="根据id获取User"><a href="#根据id获取User" class="headerlink" title="根据id获取User"></a>根据id获取User</h3><p>第一个功能就是根据用户id获取用户对象，注意这里返回的是UserModel而不是<br>UserDO，UserDO是与数据库中表的字段完全对应的，但是在service不能直接<br>将对应数据库映射的userDO传给前端，这是需要一个model作为业务逻辑交互<br>模型，这个model中不止是userDO中的所有字段，还包括用户的密码，密码也<br>是属于user的，所以这个model包含了完整的用户信息</p>
<h3 id="学生根据手机号获取验证码"><a href="#学生根据手机号获取验证码" class="headerlink" title="学生根据手机号获取验证码"></a>学生根据手机号获取验证码</h3><ol>
<li>前端展示getotp页面 发送手机号获取otp验证码，然后跳转到注册页面</li>
<li>后端收到手机号，根据random.nextInt生成5位验证码</li>
<li>HTTP请求头中的所有信息都封装在httpServletRequest，将OTP验证码同<br>用户手机号关联，使用httpsession的方式绑定手机号与OTPCODE<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpServletRequest.getSession().setAttribute(telphone, otpCode);</span><br></pre></td></tr></table></figure></li>
<li>后端将otpCode发送给前端，前端收到验证码之后跳转到注册页面</li>
</ol>
<h3 id="request-setAttribute-和request-getSession-setAttribute"><a href="#request-setAttribute-和request-getSession-setAttribute" class="headerlink" title="request.setAttribute()和request.getSession().setAttribute()"></a>request.setAttribute()和request.getSession().setAttribute()</h3><ol>
<li>request.setAttribute(“num”,value) 有效范围是一个请求范围，不发送<br>请求的界面无法获取到value的值，只能在一个request内有效，如果重定向客<br>户端，将取不到值。<br>request在当次的请求的URL之间有效，比如，你在请求某个servlet，那么你<br>提交的信息，可以使用request.getAttribute()方式获得，而当你再次跳转<br>之后，这些信息将不存在</li>
<li>request.getSession().setAttribute(“num”,value) 有效范围是一个<br>session周期，在session过期之前或者用户关闭页面之前是有效的，可以通<br>过sessionID得到自己的session，将参数存储在session中，即使重定向客<br>户端也没事，这个值可以在多个页面上使用。<br>比如访问一个网站，登录后用户信息被保存到session中，在session过期之前<br>或者用户关闭页面之前，用户信息可以通过request.getSession().<br>getAttribute()方式获得</li>
</ol>
<h3 id="qs"><a href="#qs" class="headerlink" title="qs"></a>qs</h3><p>用户发送手机号后会接收到一个验证码，然后跳转到注册页面，注意使用<br>post方式发送请求后端使用@RequestParam接收时需要使用qs对数据进<br>行处理 npm install qs –save-dev</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if (this.telphone !&#x3D; null &amp;&amp; this.telphone !&#x3D; &quot;&quot;) &#123;</span><br><span class="line">   	let form &#x3D;qs.stringify(&#123;</span><br><span class="line">       	telphone: this.telphone</span><br><span class="line">   	&#125;</span><br><span class="line">   )</span><br><span class="line">   this.$axios.post(&#39;&#x2F;getotp&#39;,form,&#123;</span><br><span class="line">       headers: &#123;</span><br><span class="line">               &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded&#39;</span><br><span class="line">               &#125;,</span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="学生获取验证码后完成注册"><a href="#学生获取验证码后完成注册" class="headerlink" title="学生获取验证码后完成注册"></a>学生获取验证码后完成注册</h3><ol>
<li>用户注册时候需要输入telphone otpCode name gender age password</li>
<li>后端从会话中的telphone获取optCode，如果与输入的验证码不一致就抛出<br>BusinessException异常，错误信息是短信验证码不符合</li>
<li>将用户的注册信息封装到userModel中，注意密码要进行加密</li>
<li>在UserService中添加一个注册功能并在impl中实现，注册功能本身必须<br>成功或者失败，不能出现用户表添加成功当密码表添加失败的情况，应该加上<br>@Transactional注解<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">register</span><span class="params">(UserModel userModel)</span> <span class="keyword">throws</span> BusinessException</span>;</span><br></pre></td></tr></table></figure></li>
<li>实现的思路首先是检验 userModel是否为空，保证代码的健壮性</li>
<li>然后把userModel转变为userDO，通过已经自动生成的insertSelective方<br>法将用户信息插入数据库中</li>
<li>注意传来的userModel中还有用户的密码，所以还要将userModel转变为<br>userpasswordDO。注意使用insertSelective而不是insert方法来插入数据</li>
</ol>
<h3 id="insert和insertSelective"><a href="#insert和insertSelective" class="headerlink" title="insert和insertSelective"></a>insert和insertSelective</h3><ol>
<li>insert就是正常的插入操作</li>
<li>insertselective首先判断这个字段是否为null，如果为null就插入的是<br>默认值，在设计数据库表的时候最好不要设置null字段</li>
</ol>
<h3 id="学生登录功能"><a href="#学生登录功能" class="headerlink" title="学生登录功能"></a>学生登录功能</h3><ol>
<li>注册完成后就会跳转到登录页面</li>
<li>登录操作就是验证用户手机号和密码是否正确，要进行入参校验</li>
<li>后端的validateLogin方法首先根据手机号获取用户信息，然后根据用户的<br>id获取相应的加密密码，如果正确说明登录成功</li>
<li>将登陆凭证加入到用户登录成功的session内</li>
</ol>
<h3 id="管理员创建课程"><a href="#管理员创建课程" class="headerlink" title="管理员创建课程"></a>管理员创建课程</h3><ol>
<li>先思考如何创建模型再考虑创建相应的数据库表。一个商品肯定有一个id<br>title price stock description sales imgUrl。考虑完以上这些属性后<br>就可以创键相应数据库表，stock与交易流水有关，每次对商品表的操作就是<br>对库存表的操作，所以新建一个库存表</li>
<li>在itemService中添加创建商品和通过商品id获取商品信息的功能<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建商品</span></span><br><span class="line"><span class="function">ItemModel <span class="title">createItem</span><span class="params">(ItemModel itemModel)</span> <span class="keyword">throws</span> BusinessException</span>;</span><br><span class="line"><span class="comment">//商品详情浏览</span></span><br><span class="line"><span class="function">ItemModel <span class="title">getItemById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="展示课程列表"><a href="#展示课程列表" class="headerlink" title="展示课程列表"></a>展示课程列表</h3><ol>
<li>在itemService中添加展示所有商品的功能，通过销量倒序排序</li>
</ol>
<h3 id="抢课活动模型创建"><a href="#抢课活动模型创建" class="headerlink" title="抢课活动模型创建"></a>抢课活动模型创建</h3><ol>
<li>首先考虑用户下单的交易模型，一个交易模型应该具有 id userId itemId<br>orderPrice amount orderAmount。 orderPrice 是商品的价格，事实上这个<br>价格可以不断变化，所以orderPrice就表示当前交易时的价格，orderAmount<br>表示总金额</li>
<li>在orderService中添加创建订单的功能，并且要保证这是在一个事务当中</li>
<li>创建一个订单分为4步</li>
</ol>
<ul>
<li>校验下单状态，下单的商品是否存在，用户是否合法，购买数量是否正确</li>
<li>落单减库存，一旦落单成功那么这部分库存就是被这个用户占有扣减的，<br>支付减库存意思是落单的时候查看库存还是有的，但是这个时候并不锁定，<br>等到用户支付成功之后才真正把这部分库存扣减下来，但是这个时候无法<br>保证还有库存<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在itemService中添加相应功能，要保证落单减库存</span></span><br><span class="line"><span class="comment">//库存扣减</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">decreaseStock</span><span class="params">(Integer itemId, Integer amount)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> BusinessException</span>;</span><br><span class="line"><span class="comment">//商品销量增加</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">increaseSales</span><span class="params">(Integer itemId, Integer amount)</span> <span class="keyword">throws</span> BusinessException</span>;</span><br></pre></td></tr></table></figure></li>
<li>订单入库如果落单减库存操作完成就可以创建一个orderModel了，然后<br>转化为orderDO入库，注意id并没有设置成自增，实际上id代表一个交易<br>流水号，一般交易流水号有16位，流水号中有一部分是自增序列，在数据<br>库中建一张序号表</li>
<li>返回前端 以上操作完成后返回orderModel即可，创建订单时要注意用户<br>必须已经登录，之前还漏了一个操作，就是下单成功商品的销量也要相应增<br>加，与减少库存的操作类似</li>
</ul>
<h3 id="秒杀抢课模型"><a href="#秒杀抢课模型" class="headerlink" title="秒杀抢课模型"></a>秒杀抢课模型</h3><ol>
<li>对于有些商品存在秒杀活动，这个数据模型包含 id promoName startDate<br>itemId promoItemPrice</li>
<li>当进入一个商品详情页的时候会有一个商品的平销价格，如果商品正在进行<br>秒杀活动的话也会有一个秒杀价格。现在添加一个功能通过商品的id获取这个商<br>品的秒杀信息，如果没有相关信息说明没有秒杀活动</li>
<li>在promoModel中还要添加一个秒杀活动的状态，1表示还未开始，2表示进行<br>中，3表示已经结束。商品还应该具有一个秒杀活动的属性，也就是promoModel，<br>如果商品的这个属性不为空那么说明这个商品处于未结束的秒杀活动，同时如果<br>不为空那么秒杀活动的状态也不能为3，如果为3说明已经结束。展现给前端的<br>itemVO如下</li>
<li>秒杀商品下单时前端也要吧promoId传给后端，promoId可能为null，这就<br>表明这个商品没有秒杀信息或者已经结束秒杀，如果为1说明秒杀活动等待<br>开始，这个时候还不能下单，如果为2那么可以下单</li>
</ol>
<h2 id="难点优化"><a href="#难点优化" class="headerlink" title="难点优化"></a>难点优化</h2><h3 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h3><h4 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h4><p>在根目录下创建 vue.config.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 使用代理 *&#x2F;</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            &#39;&#x2F;soquick&#39;: &#123;</span><br><span class="line">                &#x2F;* 目标代理服务器地址 *&#x2F;</span><br><span class="line">                target: &#39;http:&#x2F;&#x2F;localhost:8081&#39;,</span><br><span class="line">                &#x2F;* 允许跨域 *&#x2F;</span><br><span class="line">                changeOrigin: true,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h4><p>在每个控制器上加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span>(allowCredentials = <span class="string">"true"</span>,allowedHeaders = <span class="string">"*"</span>)</span><br></pre></td></tr></table></figure>
<p>创建config包，创建CrosConfig类实现WebMvcConfigurer接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"GET"</span>,<span class="string">"HEAD"</span>,<span class="string">"POST"</span>,<span class="string">"PUT"</span>,<span class="string">"DELETE"</span>,<span class="string">"OPTIONS"</span>)</span><br><span class="line">                .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                .maxAge(<span class="number">3600</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="优化校验规则"><a href="#优化校验规则" class="headerlink" title="优化校验规则"></a>优化校验规则</h3><p>对于参数中的userModel，如果自己编写校验太复杂，可以使用相关类库。<br>新建一个validator包，创建一个ValidationResult类，这个类就是验证的<br>结果类，创建ValidatorImpl类并实现InitializingBean接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ValidationResult result = validator.validate(userModel);</span><br><span class="line">   <span class="keyword">if</span> (result.isHasErrors()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(EmBusinessError</span><br><span class="line">           .PARAMETER_VALIDATION_ERROR, result.getErrMsg());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="前后端交换数据优化"><a href="#前后端交换数据优化" class="headerlink" title="前后端交换数据优化"></a>前后端交换数据优化</h3><h3 id="前端拿到数据viewobject"><a href="#前端拿到数据viewobject" class="headerlink" title="前端拿到数据viewobject"></a>前端拿到数据viewobject</h3><p>控制层获取到usermodel后也获取到用户的加密密码，但是不应该将model<br>直接传给前端，这样就把密码也传了过去，前端只需要拿到需要展示的数<br>据即可，所以在控制层需要再加一层模型对象传给前端相应的模型</p>
<h4 id="完善前后端返回对象"><a href="#完善前后端返回对象" class="headerlink" title="完善前后端返回对象"></a>完善前后端返回对象</h4><p>定义通用的返回对象——返回正确信息。也就是规范responsebody的返回参数<br>程序不出错返回的就是正确的信息。如果后端产生了错误也要给前端返回有<br>意义的信息。</p>
<ol>
<li>首先要归一化responsebody的返回参数，归化为一个统一的status+data<br>的格式。status就是返回的结果，success/fail。data就是要返回给前端的数<br>据，如果失败就是返回通用的错误码格式。response包创建CommonReturnType</li>
<li>定义通用的返回对象返回错误信息。创建error包创建commonError接口，<br>定义一个错误格式<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommonError</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getErrCode</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getErrMsg</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonError <span class="title">setErrMsg</span><span class="params">(String errMsg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>使用EmBusinessError实现CommonError的方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EmBusinessError implements CommonError&#123;</span><br><span class="line">    <span class="comment">//通用错误类型</span></span><br><span class="line">    PARAMETER_VALIDATION_ERROR(<span class="number">10001</span>,<span class="string">"参数不合法"</span>),</span><br><span class="line">    UNKNOWN_ERROR(<span class="number">10002</span>,<span class="string">"未知错误"</span>),</span><br><span class="line">    <span class="comment">//以20000开头为用户信息相关错误定义</span></span><br><span class="line">    USER_NOT_EXIST(<span class="number">20001</span>,<span class="string">"用户不存在"</span>),</span><br><span class="line">    USER_LOGIN_FAIL(<span class="number">2002</span>,<span class="string">"手机号或密码不正确"</span>),</span><br><span class="line">    USER_NOT_LOGIN(<span class="number">20003</span>,<span class="string">"用户还未登录"</span>),</span><br><span class="line">    <span class="comment">//以30000开头为交易信息错误定义</span></span><br><span class="line">    STOCK_NOT_ENOUGH(<span class="number">30001</span>,<span class="string">"库存不足"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> errCode;</span><br><span class="line">    <span class="keyword">private</span> String errMsg;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EmBusinessError</span><span class="params">(<span class="keyword">int</span> errCode,String errMsg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.errCode=errCode;</span><br><span class="line">        <span class="keyword">this</span>.errMsg=errMsg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>包装器模式实现BusinessException类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessException</span> <span class="keyword">extends</span> <span class="title">Exception</span> <span class="keyword">implements</span> <span class="title">CommonError</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CommonError commonError;</span><br><span class="line">    <span class="comment">//直接接受EmBusinessError的传参用于构造业务异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(CommonError commonError)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.commonError=commonError;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//接收自定义errMsg的方式构造业务异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(CommonError commonError, String errMsg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.commonError = commonError;</span><br><span class="line">        <span class="keyword">this</span>.commonError.setErrMsg(errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>抛出相应的异常信息后还要进行处理才能让前端看到相关错误，否则返<br>回给前端的code是500，定义exceptionhandler解决未被controller层<br>吸收的exception。在controller层创建BaseController<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义exceptionHandler解决未被controller层吸收的exception</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseStatus</span>(<span class="title">HttpStatus</span>.<span class="title">OK</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseBody</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Object</span> <span class="title">handleException</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; responseData = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BusinessException) &#123;</span><br><span class="line">            BusinessException businessException = (BusinessException) ex;</span><br><span class="line">            responseData.put(<span class="string">"errCode"</span>, businessException.getErrCode());</span><br><span class="line">            responseData.put(<span class="string">"errMsg"</span>, businessException.getErrMsg());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            responseData.put(<span class="string">"errCode"</span>, EmBusinessError.UNKNOWN_ERROR.</span><br><span class="line">            	getErrCode());</span><br><span class="line">            responseData.put(<span class="string">"errMsg"</span>, EmBusinessError.UNKNOWN_ERROR.</span><br><span class="line">            	getErrMsg());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CommonReturnType.create(responseData, <span class="string">"fail"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><h3 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对 html 标签进行转义，防止 XSS 攻击</span></span><br><span class="line">username = HtmlUtils.htmlEscape(username);</span><br></pre></td></tr></table></figure>
<h3 id="登录拦截"><a href="#登录拦截" class="headerlink" title="登录拦截"></a>登录拦截</h3><p>一个简单拦截器的逻辑如下</p>
<ol>
<li>用户访问 URL，检测是否为登录页面，如果是登录页面则不拦截</li>
<li>如果用户访问的不是登录页面，检测用户是否已登录，如果未登录则跳转<br>到登录页面</li>
</ol>
<p>为了保存登录状态，我们可以把用户信息存在 Session 对象中（当用户在应用<br>程序的 Web 页之间跳转时，存储在 Session 对象中的变量不会丢失），这样<br>在访问别的页面时，可以通过判断是否存在用户变量来判断用户是否登录</p>
<h3 id="用户信息加密"><a href="#用户信息加密" class="headerlink" title="用户信息加密"></a>用户信息加密</h3><p>之前我们的用户信息都是明文存储在数据库中的，这样做有三大弊端</p>
<ul>
<li>不安全 很多应用脱库后用户密码全网流传</li>
<li>用户也不希望我们知道他们的密码，我上不了你的号，但是我知道你的号<br>在干什么</li>
<li>如果用户在各个应用使用相同的密码，一个地方密码被盗则一连串被盗</li>
</ul>
<p>所以我们要对用户信息进行加密，主要是用于验证的敏感信息，比如密码，<br>而且这种加密最好是不可逆的，明文密码只有用户知道。加盐是提高Hash算<br>法安全性的一个常用手段，本质是在密码后面加一段随机的字符串，然后再<br>hash</p>
<ul>
<li>用户注册时，输入用户名密码，向后台发送请求</li>
<li>后台将密码加上随机生成的盐并hash，再将hash后的值存入数据库中，盐<br>也作为单独的字段存起来</li>
<li>用户登录时输入用户名密码，向后台发送请求，每个用户都有一个自己的盐</li>
<li>后台根据用户名查询出盐，和密码组合并hash，将得到的值和数据库中存<br>储的密码比对，若一致则通过验证</li>
</ul>
<h3 id="加盐为什么能提高安全性？"><a href="#加盐为什么能提高安全性？" class="headerlink" title="加盐为什么能提高安全性？"></a>加盐为什么能提高安全性？</h3><p>我们知道一个 hash 值（输出）可以对应无数输入，如果不加盐，找到一个和<br>明文密码 hash 结果相同的输入相对容易，但在有盐的情况下，如果不知道盐<br>，找到这种输入的难度就是炸裂性增长。<br>当然，如果别人有办法拿到数据库中以 hash 值存储的密码，拿到盐的信息也<br>是有可能的，但是由于不同用户盐不同，所以即使有很多用户使用了相同的密<br>码，存储在数据库里的 hash 值也不同，试图窃取信息的黑客只能一个一个<br>的去算，这才是加盐最大的意义所在。</p>
<h3 id="认证方案（session-与-token）"><a href="#认证方案（session-与-token）" class="headerlink" title="认证方案（session 与 token）"></a>认证方案（session 与 token）</h3><p>先说最简单的认证方法，即前端在每次请求时都加上用户名和密码，交由后端验<br>证。这种方法的弊端有两个：</p>
<ol>
<li>需要频繁查询数据库，导致服务器压力较大</li>
<li>安全性，如果信息被截取，攻击者就可以 一直 利用用户名密码登录（注意<br>不是因为明文不安全，是由于无法控制时效性）</li>
</ol>
<h4 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h4><p>许多语言在网络编程模块都会实现会话机制，即 session。利用 session，我们<br>可以管理用户状态，比如控制会话存在时间，在会话中保存属性等</p>
<ol>
<li>服务器接收到第一个请求时，生成 session 对象，并通过响应头告诉客户端<br>在 cookie 中放入 sessionId</li>
<li>客户端之后发送请求时，会带上包含 sessionId 的 cookie</li>
<li>服务器通过sessionId获取 session ，进而得到当前用户的状态（是否登录<br>）等信息</li>
</ol>
<p>也就是说，客户端只需要在登录的时候发送一次用户名密码，此后只需要在发送<br>请求时带上 sessionId，服务器就可以验证用户是否登录了。<br>session 存储在内存中，在用户量较少时访问效率较高，但如果一个服务器保存<br>了几十几百万个 session 就十分难顶了。同时由于同一用户的多次请求需要访问<br>到同一服务器，不能简单做集群，需要通过一些策略（session sticky）来扩展<br>，比较麻烦。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">高明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://skysea-gaoming.github.io/2021/01/22/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/">https://skysea-gaoming.github.io/2021/01/22/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/01/22/JVM%E6%80%BB%E7%BB%93/"><i class="fa fa-chevron-left">  </i><span>JVM总结</span></a></div><div class="next-post pull-right"><a href="/2021/01/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%80%BB%E7%BB%93/"><span>计算机网络总结</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://skysea-gaoming.github.io/2021/01/22/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/';
  this.page.identifier = '2021/01/22/个人项目总结/';
  this.page.title = '抢课项目总结';
}
var d = document, s = d.createElement('script');
s.src = "https://" + '你的disqus的 short-name' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://你的disqus的 short-name.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2333247715,1420619508&amp;fm=26&amp;gp=0.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By 高明</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>